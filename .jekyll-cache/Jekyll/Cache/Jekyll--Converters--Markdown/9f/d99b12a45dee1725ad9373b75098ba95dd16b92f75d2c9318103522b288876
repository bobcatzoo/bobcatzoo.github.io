I"f<p>é‡‘èéšæœºåˆ†æ(Stochastic Calculus for Finance II Continuous-Time Models)ç¬¬3ç« éƒ¨åˆ†ç« èŠ‚å¯è§†åŒ–ç¬”è®°</p>

<h2 id="32-scaled-random-walks">3.2 Scaled Random Walks</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">time</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="321-symmetric-random-walk">3.2.1 Symmetric Random Walk</h3>

\[X_j = 1 \ \ \text{if} \ \omega_j = H , \ \ X_j = -1 \ \ \text{if} \ \omega_j = T\]

\[M_0 = 0, \ M_k = \sum_{j=1}^{k} X_j, \ \text{for} \ k = 1, 2, ...\]

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">steps</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">t</span><span class="p">)</span>
<span class="n">random_walks</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">random_walks</span><span class="p">.</span><span class="n">shape</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(20,)
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="n">random_walks</span><span class="p">.</span><span class="n">mean</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">random_walks</span><span class="p">.</span><span class="n">var</span><span class="p">())</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.4
0.8399999999999999
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">random_walks</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span><span class="n">random_walks</span><span class="p">)</span>
<span class="n">random_walks</span> <span class="o">=</span> <span class="n">random_walks</span><span class="p">.</span><span class="n">cumsum</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">plot_random_walks</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">random_walk</span><span class="p">):</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">random_walk</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"Time"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"Location"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plot_random_walks</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">random_walks</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="http://localhost:4000/assets/images/SCFF03/output_11_0.png" alt="png" />
â€‹</p>

<h3 id="325-scaled-symmetric-random-walk">3.2.5 Scaled Symmetric Random Walk</h3>

<p>å°†å¯¹ç§°éšæœºæ¸¸åŠ¨ç¼©å°$n$å€ï¼Œå¹¶ä¿è¯$nt$ä¸ºæ­£æ•´æ•°ï¼Œåˆ™æœ‰</p>

\[W ^ {(n)} (t) = \frac{1}{\sqrt{n}} M_{nt}\]

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nstep</span> <span class="o">=</span> <span class="mi">100</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">steps</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">nstep</span><span class="p">),</span> <span class="n">t</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">steps</span><span class="p">.</span><span class="n">shape</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(2001,)
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">random_walks</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nstep</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">nstep</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">random_walks</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span><span class="n">random_walks</span><span class="p">)</span>
<span class="n">random_walks</span> <span class="o">=</span> <span class="n">random_walks</span><span class="p">.</span><span class="n">cumsum</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">random_walks</span><span class="p">.</span><span class="n">shape</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(2001,)
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plot_random_walks</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">random_walks</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="http://localhost:4000/assets/images/SCFF03/output_19_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nwalks</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">random_walks</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nstep</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">nwalks</span><span class="p">,</span> <span class="n">nstep</span><span class="o">*</span><span class="n">t</span><span class="p">))</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">random_walks</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nwalks</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span><span class="n">random_walks</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">random_walks</span> <span class="o">=</span> <span class="n">random_walks</span><span class="p">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">random_walks</span><span class="p">.</span><span class="n">shape</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(10, 2001)
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">random_walks</span><span class="p">)):</span>
    <span class="n">plot_random_walks</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">random_walks</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="http://localhost:4000/assets/images/SCFF03/output_23_0.png" alt="png" /></p>

<h3 id="326-limiting-distribution-of-the-scaled-random-walk">3.2.6 Limiting Distribution of the Scaled Random Walk</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nstep</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">steps</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">nstep</span><span class="p">),</span> <span class="n">t</span><span class="p">)</span>
<span class="n">nwalks</span> <span class="o">=</span> <span class="mi">10000</span>

<span class="n">random_walks</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nstep</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">nwalks</span><span class="p">,</span> <span class="n">nstep</span><span class="o">*</span><span class="n">t</span><span class="p">))</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">random_walks</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nwalks</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span><span class="n">random_walks</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">random_walks</span> <span class="o">=</span> <span class="n">random_walks</span><span class="p">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">random_walks</span><span class="p">.</span><span class="n">shape</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(10000, 20001)
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">random_walks_final</span> <span class="o">=</span> <span class="n">random_walks</span><span class="p">[:,</span> <span class="n">nstep</span><span class="o">*</span><span class="n">t</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">random_walks_final</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">random_walks_final</span><span class="p">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s">'r'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"Final location"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"Counts"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="http://localhost:4000/assets/images/SCFF03/output_27_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="n">random_walks_final</span><span class="p">.</span><span class="n">mean</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">random_walks_final</span><span class="p">.</span><span class="n">var</span><span class="p">())</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-0.0257725629303726
20.436329775000004
</code></pre></div></div>

<h3 id="327-log-normal-distribution-as-the-limit-of-the-binomial-model">3.2.7 Log-Normal Distribution as the Limit of the Binomial Model</h3>

<h4 id="é¦–å…ˆæˆ‘ä»¬è€ƒè™‘ä¸‹theorem-322æåŠçš„r--0æ—¶ç‰¹æ®Šæƒ…å½¢">é¦–å…ˆï¼Œæˆ‘ä»¬è€ƒè™‘ä¸‹<strong>Theorem 3.2.2</strong>æåŠçš„$r = 0$æ—¶ç‰¹æ®Šæƒ…å½¢</h4>

<p>å‡è®¾ä¼°ä»·ä¸Šå‡å› å­ä¸º$u_n = 1 + \frac{\sigma}{\sqrt{n}}$ï¼Œä¸Šå‡æ¦‚ç‡ä¸º$\tilde{p} = \frac{1 + r - d_n}{u_n - d_n} = \frac{\frac{\sigma}{\sqrt{n}}}{2 \frac{\sigma}{\sqrt{n}}} = \frac{1}{2}$ï¼Œä¸‹é™å› å­ä¸º$d_n = 1 - \frac{\sigma}{\sqrt{n}}$ï¼Œä¸‹é™æ¦‚ç‡ä¸º$\tilde{q} = \frac{u_n - 1 - r}{u_n - d_n} = \frac{\frac{\sigma}{\sqrt{n}}}{2 \frac{\sigma}{\sqrt{n}}} = \frac{1}{2}$ã€‚</p>

<p>å¯æ±‚å¾—</p>

\[nt = H_{nt} + T_{nt}\]

\[M_{nt} = H_{nt} - T_{nt}\]

\[H_{nt} = \frac{1}{2} (nt + M_{nt})\]

\[T_{nt} = \frac{1}{2} (nt - M_{nt})\]

<p>è‚¡ä»·$S_{n} (t)$å¯ä»¥è¡¨ç¤ºä¸º$S(0)$ä¸ºèµ·ç‚¹ï¼Œä¸Šå‡$H_{nt}$æ¬¡å’Œä¸‹é™$T_{nt}$æ¬¡ä»¥åçš„é‡‘é¢å³ï¼š</p>

\[S_n(t) = S(0) u_n ^ {H_{nt}} d_n ^ {T_{nt}} = S(0) \ \left( 1 + \frac{\sigma}{\sqrt{n}} \right) ^ {\frac{1}{2} (nt + M_{nt})} \left( 1 - \frac{\sigma}{\sqrt{n}} \right) ^ {\frac{1}{2} (nt - M_{nt})}\]

<p>æ ¹æ®<strong>Theorem 3.2.2</strong>ï¼Œå½“$n \to \infty$æ—¶:</p>

\[\lim_{n \to \infty} S_n(t) = S_0 \exp \left( \sigma W(t) - \frac{1}{2} \sigma ^2 t \right)\]

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nstep</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">t</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">nwalks</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">r</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">S_0</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">u_n</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">sigma</span><span class="o">/</span><span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nstep</span><span class="p">)</span>
<span class="n">d_n</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">sigma</span><span class="o">/</span><span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nstep</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">q</span> <span class="o">=</span> <span class="mf">0.5</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">steps</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">nstep</span><span class="p">),</span> <span class="n">t</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X_nt</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">nwalks</span><span class="p">,</span><span class="n">nstep</span><span class="o">*</span><span class="n">t</span><span class="p">))</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">M_nt</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nwalks</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">X_nt</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">M_nt</span> <span class="o">=</span> <span class="n">M_nt</span><span class="p">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">M_nt</span><span class="p">.</span><span class="n">shape</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(10, 1001)
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">H_nt</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">nstep</span><span class="o">*</span><span class="n">t</span> <span class="o">+</span> <span class="n">M_nt</span><span class="p">)</span>
<span class="n">T_nt</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">nstep</span><span class="o">*</span><span class="n">t</span> <span class="o">-</span> <span class="n">M_nt</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">S_t</span> <span class="o">=</span> <span class="n">S_0</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">u_n</span><span class="p">,</span> <span class="n">H_nt</span><span class="p">)</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">d_n</span><span class="p">,</span> <span class="n">T_nt</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nwalks</span><span class="p">):</span>
    <span class="n">plot_random_walks</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">S_t</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">S_t</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s">'r'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="http://localhost:4000/assets/images/SCFF03/output_40_0.png" alt="png" /></p>

<blockquote>
  <p>$\sigma$çš„å®šä¹‰å¦‚ä¸‹ï¼Œæ³¨æ„æ­¤$\sigma$ééšæœºæ¸¸èµ°æ¨¡æ‹Ÿç»ˆå€¼åˆ†å¸ƒçš„$\sigma$</p>
</blockquote>

\[\frac{1}{T_2 - T_1} \lim_{j=0}^{n-1} \left( \log \frac{S(t_{j+1})}{S(t_j)} \right) ^2 \ \approx \ \sigma ^ 2\]

<blockquote>
  <p>ä»¥ä¸‹æˆ‘ä»¬éšæœºé€‰æ‹©ä¸€æ¡è·¯å¾„è¿›è¡Œè®¡ç®—éªŒè¯</p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="n">nwalks</span><span class="p">)</span>
<span class="n">walks</span> <span class="o">=</span> <span class="n">S_t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="n">walks_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">walks</span><span class="p">)</span>
<span class="n">walks_list_</span> <span class="o">=</span> <span class="p">[</span><span class="n">walks_list</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">walks_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">walks_list</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">walks</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">walks_list_</span><span class="p">)</span>
<span class="n">walks</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">walks</span><span class="p">)</span>
<span class="n">walks</span> <span class="o">=</span> <span class="n">walks</span> <span class="o">*</span> <span class="n">walks</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">walks</span><span class="p">)</span> <span class="o">/</span> <span class="n">t</span><span class="p">)</span>
<span class="n">sigma</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.0500004166729163
</code></pre></div></div>

<blockquote>
  <p>$\sigma$çš„é‡‘é¢ä¸æˆ‘ä»¬å‰é¢è®¾å®šçš„é‡‘é¢ä¸€è‡´ã€‚</p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">random</span>

<span class="n">nwalks</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">random_walks</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">choice</span><span class="p">([</span><span class="n">u_n</span><span class="p">,</span> <span class="n">d_n</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">nwalks</span><span class="p">,</span> <span class="n">nstep</span><span class="o">*</span><span class="n">t</span><span class="p">))</span>
<span class="n">random_walks</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nwalks</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span><span class="n">random_walks</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">random_walks_cumprod</span> <span class="o">=</span> <span class="n">random_walks</span><span class="p">.</span><span class="n">cumprod</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">paths</span> <span class="o">=</span> <span class="n">random_walks_cumprod</span><span class="p">[:,</span> <span class="n">nstep</span><span class="o">*</span><span class="n">t</span><span class="p">]</span>
<span class="n">paths</span> <span class="o">=</span> <span class="n">paths</span> <span class="o">*</span> <span class="n">S_0</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bins</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">bins</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">paths</span><span class="p">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s">'r'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"Final location"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"Counts"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="http://localhost:4000/assets/images/SCFF03/output_45_0.png" alt="png" /></p>

<p><a href="https://zh.wikipedia.org/wiki/%E5%87%A0%E4%BD%95%E5%B8%83%E6%9C%97%E8%BF%90%E5%8A%A8">å‡ ä½•å¸ƒæœ—è¿åŠ¨</a>åŠå…¶å‡å€¼ä¸æ–¹å·®ï¼ˆè¯¦ç»†æ¨å¯¼è§ä»¥ä¸‹3.8èŠ‚ï¼‰:</p>

\[S_t = S_0 \exp \left( \sigma W(t) + (r - \frac{\sigma^2}{2})t\right) \tag{1.31}\]

\[\mathbb{E} (S_t) = S_0 e ^ {r t}\]

\[\mathbb{Var}(S_t) = S_0 ^ 2 e ^ {2 r t} \left( e ^ {\sigma ^ 2 t} - 1\right)\]

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sample_mean</span> <span class="o">=</span> <span class="n">paths</span><span class="p">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">theoretical_mean</span> <span class="o">=</span> <span class="n">S_0</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>

<span class="n">sample_std</span> <span class="o">=</span> <span class="n">paths</span><span class="p">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">theoretical_std</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">S_0</span> <span class="o">*</span> <span class="n">S_0</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="s">"sample_mean = %f"</span> <span class="o">%</span> <span class="n">sample_mean</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"theoretical_mean = %f"</span> <span class="o">%</span> <span class="n">theoretical_mean</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"sample_std = %f"</span> <span class="o">%</span> <span class="n">sample_std</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"theoretical_std = %f"</span> <span class="o">%</span> <span class="n">theoretical_std</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sample_mean = 99.950854
theoretical_mean = 100.000000
sample_std = 15.860752
theoretical_std = 15.910860
</code></pre></div></div>

<p>å°†ç»ˆå€¼é‡‘é¢å–å¯¹æ•°ï¼Œç»˜åˆ¶å…¶ç›´æ–¹å›¾å¹¶æ¯”è¾ƒå…¶å‡å€¼å’Œæ–¹å·®ä¸ç†è®ºå€¼çš„ä¸€è‡´æ€§ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">log_paths</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">log_paths</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">bins</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">log_paths</span><span class="p">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s">'r'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"Final location"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"Counts"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="http://localhost:4000/assets/images/SCFF03/output_49_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sample_mean</span> <span class="o">=</span> <span class="n">log_paths</span><span class="p">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">theoretical_mean</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">S_0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span>

<span class="n">sample_var</span> <span class="o">=</span> <span class="n">log_paths</span><span class="p">.</span><span class="n">var</span><span class="p">()</span>
<span class="n">theoretical_var</span> <span class="o">=</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">t</span>

<span class="k">print</span><span class="p">(</span><span class="s">"sample_mean = %f"</span> <span class="o">%</span> <span class="n">sample_mean</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"theoretical_mean = %f"</span> <span class="o">%</span> <span class="n">theoretical_mean</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"sample_var = %f"</span> <span class="o">%</span> <span class="n">sample_var</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"theoretical_var = %f"</span> <span class="o">%</span> <span class="n">theoretical_var</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sample_mean = 4.592218
theoretical_mean = 4.592670
sample_var = 0.024949
theoretical_var = 0.025000
</code></pre></div></div>

<p>é€šè¿‡è®¡ç®—å¯çŸ¥ï¼Œæ¨¡æ‹Ÿç»“æœçš„å‡å€¼åŠæ–¹å·®ä¸ç†è®ºå€¼è¾ƒä¸ºå»åˆã€‚</p>

<h4 id="å…¶æ¬¡æˆ‘ä»¬è€ƒè™‘exercise-38æ¶‰åŠçš„ä¸€èˆ¬æƒ…å½¢">å…¶æ¬¡ï¼Œæˆ‘ä»¬è€ƒè™‘Exercise 3.8æ¶‰åŠçš„ä¸€èˆ¬æƒ…å½¢</h4>

<p>æˆ‘ä»¬ç”¨$n$æœŸäºŒå‰æ ‘æ¨¡å‹æ¨¡æ‹Ÿå•ä½æ—¶é—´é—´éš”å†…çš„è‚¡ä»·å˜åŒ–ï¼Œå•ä½æ—¶é—´å†…çš„åˆ©ç‡ä¸º$r_n = \frac{r}{n}$ï¼Œå‡è®¾ä¸Šå‡å› å­ä¸º$u_n = e ^ {\frac{\sigma}{\sqrt{n}}}$ï¼Œä¸‹é™å› å­ä¸º$d_n = e ^ {-\frac{\sigma}{\sqrt{n}}}$ã€‚åˆ™</p>

\[\tilde{p}_n = \frac{1+r_n-d_n}{u_n-d_n} = \frac{1+\frac{r}{n} - e ^ {-\sigma/ \sqrt{n}}} {e ^ {\sigma/ \sqrt{n}} - e ^ {-\sigma/ \sqrt{n}}} \tag{1.21}\]

\[\tilde{q}_n = \frac{u_n-1-r_n}{u_n-d_n} = \frac{e ^ {\sigma/ \sqrt{n}} -1 -\frac{r}{n}} {e ^ {\sigma/ \sqrt{n}} - e ^ {-\sigma/ \sqrt{n}}}   \tag{1.22}\]

<p>é€‰å–$t = t_1 - t_0$ï¼Œæ»¡è¶³$nt$ä¸ºæ•´æ•°ï¼Œæˆ‘ä»¬ç”¨$nt$æœŸäºŒå‰æ ‘æ¨¡æ‹Ÿ$t$æ—¶é—´å†…çš„è‚¡ä»·ã€‚å®šä¹‰</p>

\[M_{nt,n} = \sum_{k=1}^{nt} X_{k,n} \tag{1.23}\]

<p>å…¶ä¸­$X_{1,n}, X_{2,n} â€¦ X_{n,n}$ä¸ºç‹¬ç«‹åŒåˆ†å¸ƒéšæœºå˜é‡ï¼Œæ»¡è¶³</p>

\[\widetilde{\mathbb{P}}(X_{k,n} = 1) = \tilde{p}_n,\ \ \widetilde{\mathbb{P}}(X_{k,n} = -1) = \tilde{q}_n, \ k = 1,2,...n.\]

<p>è®°$nt$æ¬¡äºŒå‰æ ‘æ¨¡æ‹Ÿå†…å‡ºç°è‚¡ä»·ä¸Šå‡çš„æ¬¡æ•°ä¸º$H_{nt}$ï¼Œå‡ºç°ä¸‹é™çš„æ¬¡æ•°ä¸º$T_{nt}$ï¼Œåˆ™$nt = H_{nt} + T_{nt}$ï¼Œ$M_{nt,n} = H_{nt} - T_{nt}$ã€‚ç”±æ­¤å¯å¾—ï¼š</p>

\[H_{nt} = \frac{1}{2}(nt + M_{nt,n})\]

\[T_{nt} = \frac{1}{2}(nt - M_{nt,n})\]

<p>$t$æ—¶åˆ»è‚¡ä»·ç»è¿‡$nt$æœŸäºŒå‰æ ‘æ¨¡æ‹Ÿåå¯ç”±ä¸‹å¼å¾—å‡º</p>

\[\begin{aligned}
S_n(t) &amp;= S_0 u_{n}^{H_{nt,n}} d_{n}^{T_{nt,n}} \\
\\
&amp;= S_0 u_{n}^{\frac{1}{2}(nt + M_{nt,n})} d_{n}^{\frac{1}{2}(nt - M_{nt,n})} \\
\\
&amp;= S_0 \exp \left(\frac{\sigma}{2\sqrt{n}}(nt + M_{nt,n})\right) \exp \left(-\frac{\sigma}{2\sqrt{n}}(nt - M_{nt,n})\right) \\
\\
&amp;= S_0 \exp \left(\frac{\sigma}{\sqrt{n}}M_{nt,n} \right)
\end{aligned} \tag{1.24}\]

<p>å¦‚æœæˆ‘ä»¬èƒ½æ±‚å¾—$n \to \infty$æ—¶$\frac{\sigma}{\sqrt{n}}M_{nt,n}$çš„åˆ†å¸ƒ$\chi$ï¼Œåˆ™è‚¡ä»·$S(t)$çš„åˆ†å¸ƒä¹Ÿå°±éšä¹‹å¯ä»¥ç¡®å®šã€‚æ ¹æ®ä¹ é¢˜æç¤ºï¼Œæˆ‘ä»¬åˆ†4æ­¥è¿›è¡Œè¯æ˜ã€‚</p>

\[\blacksquare \Box \square \square\]

<h5 id="1-æ ¹æ®çŸ©ç”Ÿæˆå‡½æ•°ä¸æ¦‚ç‡åˆ†å¸ƒçš„ä¸€ä¸€å¯¹åº”å…³ç³»æˆ‘ä»¬å¯ä»¥è€ƒè™‘æ±‚è§£frac1sqrtnm_ntnçš„çŸ©ç”Ÿæˆå‡½æ•°varphi_nuç„¶åå†æ±‚å…¶æé™">1. æ ¹æ®çŸ©ç”Ÿæˆå‡½æ•°ä¸æ¦‚ç‡åˆ†å¸ƒçš„ä¸€ä¸€å¯¹åº”å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘æ±‚è§£$\frac{1}{\sqrt{n}}M_{nt,n}$çš„çŸ©ç”Ÿæˆå‡½æ•°$\varphi_n(u)$ï¼Œç„¶åå†æ±‚å…¶æé™ã€‚</h5>

\[\begin{aligned}
\varphi_n(u) &amp;= \widetilde{\mathbb{E}} \left( e ^ {u \frac{1}{\sqrt{n}}M_{nt,n}} \right) \\
\\
&amp;= \left[ \widetilde{\mathbb{E}} \left( e ^ {u \frac{1}{\sqrt{n}}X_{1,n}} \right) \right] ^{nt} \\
\\
&amp;= \left( e^{\frac{u}{\sqrt{n}} \tilde{p}_n} + e^{-\frac{u}{\sqrt{n}} \tilde{q}_n} \right) ^{nt} \\
\\
&amp;= \left[ e^{\frac{u}{\sqrt{n}}} \left(\frac{1+\frac{r}{n} - e ^ {-\sigma/ \sqrt{n}}} {e ^ {\sigma/ \sqrt{n}} - e ^ {-\sigma/ \sqrt{n}}}\right) +  e^{-\frac{u}{\sqrt{n}}} \left(\frac{e ^ {\sigma/ \sqrt{n}}-1-\frac{r}{n}} {e ^ {\sigma/ \sqrt{n}} - e ^ {-\sigma/ \sqrt{n}}}\right)\right] ^{nt}
\end{aligned} \tag{1.25}\]

<h5 id="2-ä¸Šå¼å…³äºç¦»æ•£å˜é‡nçš„æé™è½¬æ¢ä¸ºå…³äºè¿ç»­å˜é‡xçš„æé™">2. ä¸Šå¼å…³äºç¦»æ•£å˜é‡$n$çš„æé™è½¬æ¢ä¸ºå…³äºè¿ç»­å˜é‡$x$çš„æé™ã€‚</h5>

<p>é€‰å–$x = \frac{1}{\sqrt{n}}$ï¼Œåˆ™</p>

\[\lim_{n \to \infty}\varphi_n(u) = \lim_{x \to 0}\varphi_{\frac{1}{x^2}}(u)\]

\[\lim_{x \to 0} \varphi_{\frac{1}{x^2}}(u) = \left[ e^{ux} \left(\frac{1+rx^2 - e ^ {-\sigma x}} {e ^ {\sigma x} - e ^ {-\sigma x}}\right) +  e^{-ux} \left(\frac{e ^ {\sigma x}-1-rx^2} {e ^ {\sigma x} - e ^ {-\sigma x}}\right)\right] ^{\frac{t}{x^2}} \tag{1.26}\]

<h5 id="3-ç”±äºæŒ‡æ•°å‡½æ•°ä¸æ˜“æ±‚æé™æˆ‘ä»¬è½¬è€Œæ±‚å…¶å¯¹æ•°å‡½æ•°log-left-varphi_frac1x2u-right">3. ç”±äºæŒ‡æ•°å‡½æ•°ä¸æ˜“æ±‚æé™ï¼Œæˆ‘ä»¬è½¬è€Œæ±‚å…¶å¯¹æ•°å‡½æ•°$\log \left[ \varphi_{\frac{1}{x^2}}(u) \right]$</h5>

<p>é€šè¿‡è§‚å¯Ÿåˆ†æ¯çš„å½¢å¼ï¼Œæˆ‘ä»¬è€ƒè™‘æ„é€ åŒæ›²å‡½æ•°ï¼Œç„¶ååˆ©ç”¨åŒæ›²å‡½æ•°çš„ä»¥ä¸‹æ€§è´¨ï¼š</p>

\[\text{sinh}z = \frac{e^z - e^{-z}}{2}\]

\[\text{cosh}z = \frac{e^z + e^{-z}}{2}\]

\[\text{sinh}(A-B) = \text{sinh}A \text{cosh}B - \text{cosh}A\text{sinh}B\]

<p>å¯¹å…¬å¼(1.26)è¿›è¡ŒåŒ–ç®€å¦‚ä¸‹ï¼š</p>

\[\begin{aligned}
\lim_{x \to 0} \log \left[\varphi_{\frac{1}{x^2}}(u)\right] &amp;= \lim_{x \to 0} \frac{t}{x^2} \log \left[ e^{ux} \left(\frac{1+rx^2 - e ^ {-\sigma x}} {e ^ {\sigma x} - e ^ {-\sigma x}}\right) +  e^{-ux} \left(\frac{e ^ {\sigma x}-1-rx^2} {e ^ {\sigma x} - e ^ {-\sigma x}}\right)\right] \\
\\
&amp;= \lim_{x \to 0} \frac{t}{x^2} \log \left[ \frac{(1+rx^2)e^{ux} + e^{(u-\sigma)x}} {e^{\sigma x} - e^{-\sigma x}} + \frac{e^{(\sigma-u)x} - (1+rx^2)e^{-ux}} {e^{\sigma x} - e^{-\sigma x}} \right] \\
\\
&amp;= \lim_{x \to 0} \frac{t}{x^2} \log \left[ \frac{(1+rx^2) (e^{ux}-e^{-ux}) + e^{(\sigma-u)x} - e^{-(\sigma-u)x}} {e^{\sigma x} - e^{-\sigma x}} \right] \\
\\
&amp;= \lim_{x \to 0} \frac{t}{x^2} \log \left[ \frac{(1+rx^2) \cdot 2 \cdot \text{sinh}ux + 2 \cdot \text{sinh}(\sigma-u)x} {2 \cdot \text{sinh}\sigma x} \right] \\
\\
&amp;= \lim_{x \to 0} \frac{t}{x^2} \log \left[ \frac{(1+rx^2) \text{sinh}ux + \text{sinh}(\sigma-u)x} {\text{sinh}\sigma x}\right] \\
\\
&amp;= \lim_{x \to 0} \frac{t}{x^2} \log \left[ \frac{(1+rx^2)\text{sinh}ux + \text{sinh}\sigma x \cdot \text{cosh}ux -\text{cosh}\sigma x \cdot \text{sinh}ux} {\text{sinh}\sigma x} \right] \\
\\
&amp;= \lim_{x \to 0} \frac{t}{x^2} \log \left[ \text{cosh}ux + \frac{(1+rx^2-\text{cosh}\sigma x) \text{sinh}ux} {\text{sinh}\sigma x}\right]
\end{aligned} \tag{1.27}\]

<p>ç„¶ååˆ©ç”¨ä»¥ä¸‹åŒæ›²å‡½æ•°çš„æ³°å‹’çº§æ•°å±•å¼€å¼:</p>

\[\text{sinh} z = z + O(z^3)\]

\[\text{cosh} = 1 + \frac{z^2}{2} + O(z^4)\]

<p>å¯¹å…¬å¼(1.27)ç»§ç»­åŒ–ç®€:</p>

\[\begin{aligned}
\lim_{x \to 0} \log \left[\varphi_{\frac{1}{x^2}}(u)\right] &amp;= \lim_{x \to 0} \frac{t}{x^2} \log \left[ \text{cosh}ux + \frac{(1+rx^2-\text{cosh}\sigma x) \text{sinh}ux} {\text{sinh}\sigma x}\right] \\
\\
&amp;= \lim_{x \to 0} \frac{t}{x^2} \log \left[ 1 + \frac{(ux)^2}{2} + O(x^4) + \frac{[ 1+rx^2 - 1 - \frac{(\sigma x)^2}{2} + O(x^4) ]\cdot[ux+O(x^3)]} {\sigma x + O(x^3)} \right] \\
\\
&amp;= \lim_{x \to 0} \frac{t}{x^2} \log \left[ 1 + \frac{u^2x^2}{2} + \frac{(r-\frac{\sigma ^2}{2})ux^3 + O(x^5)} {\sigma x + O(x^3)} + O(x^4) \right] \\
\\
&amp;= \lim_{x \to 0} \frac{t}{x^2} \log \left[ 1 + \frac{u^2x^2}{2} + \frac{(r-\frac{\sigma ^2}{2})ux^3 (1+O(x^2))} {\sigma x(1 + O(x^2))} + O(x^4) \right] \\
\\
&amp;= \lim_{x \to 0} \frac{t}{x^2} \log \left[ 1 + \frac{u^2x^2}{2} + \frac{rux^2}{\sigma} - \frac{\sigma ux^2}{2}+ O(x^4) \right]
\end{aligned} \tag{1.28}\]

<h5 id="4-åˆ©ç”¨-textlog1x--x--ox2-è¿›ä¸€æ­¥åŒ–ç®€ä¸Šå¼">4. åˆ©ç”¨ $\text{log}(1+x) = x + O(x^2)$ è¿›ä¸€æ­¥åŒ–ç®€ä¸Šå¼</h5>

\[\begin{aligned}
\lim_{x \to 0} \log \left[\varphi_{\frac{1}{x^2}}(u) \right]&amp;= \lim_{x \to 0} \frac{t}{x^2} \left[ \frac{u^2x^2}{2} + \frac{rux^2}{\sigma} - \frac{\sigma ux^2}{2}+ O(x^4) \right] \\
\\
&amp;= t \left( \frac{u^2}{2} + \frac{ru}{\sigma} - \frac{\sigma u}{2}\right) \\
\\
&amp;= \frac{t}{2}u^2 + t \left( \frac{r}{\sigma}-\frac{\sigma}{2} \right)u
\end{aligned} \tag{1.29}\]

<p>ç”±å…¬å¼(1.29)å¯å¾—å½“$n \to \infty$æ—¶,</p>

\[\varphi_n(u) \to \exp \left( \frac{t}{2}u^2 + t ( \frac{r}{\sigma}-\frac{\sigma}{2} )u \right)\]

\[\Box \square \square \blacksquare\]

<p>æˆ‘ä»¬çŸ¥é“æ­£æ€éšæœºå˜é‡$X$çš„çŸ©ç”Ÿæˆå‡½æ•°ä¸º</p>

\[\varphi_X(u) = \exp \left( \frac{\sigma^2}{2}u^2 + \mu u \right) \tag{1.30}\]

<p>å…¶ä¸­$\mu$ä¸ºå‡å€¼ï¼Œ$\sigma$ä¸ºæ ‡å‡†å·®ã€‚ç”±æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºå½“$n \to \infty$æ—¶ï¼Œ$\frac{1}{\sqrt{n}}M_{nt,n}$è¶‹è¿‘äºå‡å€¼ä¸º$(\frac{r}{\sigma}-\frac{\sigma}{2})t$ï¼Œæ ‡å‡†å·®ä¸º$\sqrt{t}$çš„æ­£æ€åˆ†å¸ƒã€‚äº¦å³$\frac{\sigma}{\sqrt{n}}M_{nt,n}$è¶‹è¿‘äºå‡å€¼ä¸º$(r-\frac{\sigma^2}{2})t$ï¼Œæ ‡å‡†å·®ä¸º$\sigma \sqrt{t}$çš„æ­£æ€åˆ†å¸ƒã€‚è€Œè¿™æ­£ä¸åˆ†å¸ƒ$\sigma W(t) + (r - \frac{\sigma^2}{2})t,\ W(t)$ä¸ºå¸ƒæœ—è¿åŠ¨ç›¸å»åˆï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†$\lim_{n \to \infty} S_n(t) = S_t$å†™æˆå¦‚ä¸‹å½¢å¼</p>

\[S_t = S_0 \exp \left( \sigma W(t) + (r - \frac{\sigma^2}{2})t\right) \tag{1.31}\]

<p>ä¸‹é¢æˆ‘ä»¬ç»§ç»­æ±‚$dS_t$å³è‚¡ä»·å˜åŠ¨çš„è¡¨è¾¾å¼ï¼Œä»¤</p>

\[X_t = \sigma W(t) + (r - \frac{\sigma^2}{2})t\]

\[f(X_t) = S_t= S_0 e^{X_t}\]

<p>åˆ™</p>

\[{f}'(X_t) = {f}''(X_t) = f(X_t)\]

\[d X_t = \sigma d W(t) + (r - \frac{\sigma^2}{2}) d t\]

\[d X_t d X_t = \sigma^2 d t\]

<p>æ ¹æ®ä¼Šè—¤å…¬å¼å¯å¾—:</p>

\[\begin{aligned}
d S_t &amp;= {f}'(X_t) d X_t + \frac{1}{2} {f}''(X_t) d X_t d X_t \\
\\
&amp;= S_t d X_t + \frac{1}{2} S_t d X_t d X_t \\
\\
&amp;= \sigma S_t d W(t) + r S_t dt - \frac{\sigma^2}{2}S_t dt + \frac{\sigma^2}{2}S_t dt\\
\\
&amp;= \sigma S_t d W(t) + r S_t dt
\end{aligned} \tag{1.32}\]

<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±é€šè¿‡å…¬å¼(1.31)æ±‚å¾—äº†å…¬å¼(1.32)ï¼Œåä¹‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”±å…¬å¼(1.32)æ±‚å¾—å…¬å¼(1.31)ï¼Œå³äºŒè€…äº’ç›¸ç­‰ä»·ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nstep</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">npaths</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">r</span> <span class="o">=</span> <span class="mf">0.03</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">S_0</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">t</span> <span class="o">=</span> <span class="mi">8</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">r_n</span> <span class="o">=</span> <span class="n">r</span> <span class="o">/</span> <span class="n">nstep</span>
<span class="n">u_n</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">sigma</span> <span class="o">/</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nstep</span><span class="p">))</span>
<span class="n">d_n</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">sigma</span> <span class="o">/</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nstep</span><span class="p">))</span>
<span class="n">p_n</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">r_n</span> <span class="o">-</span> <span class="n">d_n</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">u_n</span> <span class="o">-</span> <span class="n">d_n</span><span class="p">)</span>
<span class="n">q_n</span> <span class="o">=</span> <span class="p">(</span><span class="n">u_n</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">r_n</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">u_n</span> <span class="o">-</span> <span class="n">d_n</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="s">"r_n = %f"</span> <span class="o">%</span> <span class="n">r_n</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"u_n = %f"</span> <span class="o">%</span> <span class="n">u_n</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"d_n = %f"</span> <span class="o">%</span> <span class="n">d_n</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"p_n = %f"</span> <span class="o">%</span> <span class="n">p_n</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"q_n = %f"</span> <span class="o">%</span> <span class="n">q_n</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>r_n = 0.000030
u_n = 1.006345
d_n = 0.993695
p_n = 0.500791
q_n = 0.499209
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span> <span class="c1">#ç”¨äºè®¡ç®—arrayä¸­æ•°å€¼å‡ºç°æ¬¡æ•°
</span><span class="kn">import</span> <span class="nn">time</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">simples</span> <span class="o">=</span> <span class="mi">10000000</span>
<span class="n">risk_neutral_probability</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">choice</span><span class="p">([</span><span class="n">u_n</span><span class="p">,</span> <span class="n">d_n</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="n">p_n</span><span class="p">,</span> <span class="n">q_n</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">simples</span><span class="p">))</span>

<span class="n">simple_pn</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">risk_neutral_probability</span><span class="p">)[</span><span class="n">u_n</span><span class="p">]</span> <span class="o">/</span> <span class="n">simples</span>
<span class="n">simple_qn</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">risk_neutral_probability</span><span class="p">)[</span><span class="n">d_n</span><span class="p">]</span> <span class="o">/</span><span class="n">simples</span>

<span class="k">print</span><span class="p">(</span><span class="s">"simple_pn = %f"</span> <span class="o">%</span> <span class="n">simple_pn</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"simple_qn = %f"</span> <span class="o">%</span> <span class="n">simple_qn</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>simple_pn = 0.500771
simple_qn = 0.499229
</code></pre></div></div>

<p>æ­¥æ•°è¶³å¤Ÿå¤§æ—¶ï¼Œæ ·æœ¬æ¦‚ç‡åˆ†å¸ƒè¶‹è¿‘äºç†è®ºè®¡ç®—çš„é£é™©ä¸­æ€§æ¦‚ç‡</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">steps</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">nstep</span><span class="p">),</span> <span class="n">t</span><span class="p">)</span> 
<span class="n">rnp</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">choice</span><span class="p">([</span><span class="n">u_n</span><span class="p">,</span> <span class="n">d_n</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="n">p_n</span><span class="p">,</span> <span class="n">q_n</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">npaths</span><span class="p">,</span> <span class="n">nstep</span><span class="o">*</span><span class="n">t</span><span class="p">))</span>
<span class="n">rnp</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">ones</span><span class="p">((</span><span class="n">npaths</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">rnp</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">rnp_cumpd</span> <span class="o">=</span> <span class="n">rnp</span><span class="p">.</span><span class="n">cumprod</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">paths</span> <span class="o">=</span> <span class="n">rnp_cumpd</span><span class="p">[:,</span> <span class="n">nstep</span><span class="o">*</span><span class="n">t</span><span class="p">]</span>
<span class="n">paths</span> <span class="o">=</span> <span class="n">paths</span> <span class="o">*</span> <span class="n">S_0</span>

<span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1.7295098304748535
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">paths</span><span class="p">.</span><span class="n">shape</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(10000,)
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="n">paths</span><span class="p">.</span><span class="n">mean</span><span class="p">())</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>125.57620060471794
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">bins</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">paths</span><span class="p">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s">'r'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"Final location"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"Counts"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="http://localhost:4000/assets/images/SCFF03/output_86_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sample_mean</span> <span class="o">=</span> <span class="n">paths</span><span class="p">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">theoretical_mean</span> <span class="o">=</span> <span class="n">S_0</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>

<span class="n">sample_std</span> <span class="o">=</span> <span class="n">paths</span><span class="p">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">theoretical_std</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">S_0</span> <span class="o">*</span> <span class="n">S_0</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="s">"sample_mean = %f"</span> <span class="o">%</span> <span class="n">sample_mean</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"theoretical_mean = %f"</span> <span class="o">%</span> <span class="n">theoretical_mean</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"sample_std = %f"</span> <span class="o">%</span> <span class="n">sample_std</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"theoretical_std = %f"</span> <span class="o">%</span> <span class="n">theoretical_std</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sample_mean = 125.576201
theoretical_mean = 127.124915
sample_std = 75.941466
theoretical_std = 78.068337
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">log_paths</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">log_paths</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">bins</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">log_paths</span><span class="p">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s">'r'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"Final location"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"Counts"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="http://localhost:4000/assets/images/SCFF03/output_88_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sample_mean</span> <span class="o">=</span> <span class="n">log_paths</span><span class="p">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">theoretical_mean</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">S_0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span>

<span class="n">sample_var</span> <span class="o">=</span> <span class="n">log_paths</span><span class="p">.</span><span class="n">var</span><span class="p">()</span>
<span class="n">theoretical_var</span> <span class="o">=</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">t</span>

<span class="k">print</span><span class="p">(</span><span class="s">"sample_mean = %f"</span> <span class="o">%</span> <span class="n">sample_mean</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"theoretical_mean = %f"</span> <span class="o">%</span> <span class="n">theoretical_mean</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"sample_var = %f"</span> <span class="o">%</span> <span class="n">sample_var</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"theoretical_var = %f"</span> <span class="o">%</span> <span class="n">theoretical_var</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sample_mean = 4.677318
theoretical_mean = 4.685170
sample_var = 0.311049
theoretical_var = 0.320000
</code></pre></div></div>

<p>é€šè¿‡è®¡ç®—å¯çŸ¥ï¼Œåœ¨$r \neq 0$çš„ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¨¡æ‹Ÿç»“æœçš„å‡å€¼åŠæ–¹å·®ä¸ç†è®ºå€¼è¾ƒä¸ºå»åˆã€‚</p>

<h2 id="37-reflection-principle">3.7 Reflection Principle</h2>

<h3 id="371-ç†è®ºç»“æœ">3.7.1 ç†è®ºç»“æœ</h3>

<p><strong>å®šç†3.7.1</strong> å¯¹äºæ‰€æœ‰$m \neq 0$ï¼Œéšæœºå˜é‡$\tau_m$å…·æœ‰ç´¯ç§¯åˆ†å¸ƒå‡½æ•°ï¼š</p>

\[\begin{aligned}
\mathbb{P}(\tau_m \leq t ) &amp;= 2 \mathbb{P}(W(t) &gt;= m) \\
\\
&amp;= \frac{2}{\sqrt{2 \pi t}} \int_{m}^{\infty} e^{-\frac{x^2}{2t}} dx \\
\\
&amp;= \int_{\frac{\left| m \right|}{\sqrt{t}}}^{\infty} e^{-\frac{y^2}{2}} dy = 2 \left[ 1 - \Phi(\frac{\left| m \right|}{\sqrt{t}}) \right], \qquad t \geq 0
\end{aligned}\]

<p>ä»¥åŠæ¦‚ç‡å¯†åº¦ï¼š</p>

\[f_{\tau_m} = \frac{d}{dt} \mathbb{P}(\tau_m \leq t) = \frac{\left| m \right|}{t\sqrt{2\pi t}} e^{-\frac{m^2}{2t}}, \quad t \geq 0\]

<blockquote>
  <p>å…¶ä¸­$\tau_m$è¡¨ç¤ºå¸ƒæœ—è¿åŠ¨é¦–æ¬¡åˆ°è¾¾æ°´å¹³$m$çš„æ—¶é—´</p>
</blockquote>

<h3 id="372-pythonæ¨¡æ‹Ÿ">3.7.2 Pythonæ¨¡æ‹Ÿ</h3>

<h4 id="1-ç”Ÿæˆå¸ƒæœ—è¿åŠ¨è·¯å¾„">1. ç”Ÿæˆå¸ƒæœ—è¿åŠ¨è·¯å¾„</h4>

<blockquote>
  <p>å¦‚ä»¥ä¸‹ç”Ÿæˆçš„(npath * nstep)ç»´çŸ©é˜µè¶…å‡ºå†…å­˜ï¼Œå¯ç”¨2.6å°èŠ‚å¾ªç¯æ–¹æ³•è§£å†³</p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">npaths</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">nstep</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">t</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">steps</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">nstep</span><span class="p">),</span> <span class="n">t</span><span class="p">)</span>
<span class="n">paths</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">nstep</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">npaths</span><span class="p">,</span> <span class="n">nstep</span><span class="o">*</span><span class="n">t</span><span class="p">))</span>
<span class="n">paths</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">npaths</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">paths</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">paths</span> <span class="o">=</span> <span class="n">paths</span><span class="p">.</span><span class="n">cumsum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<blockquote>
  <p>é€šè¿‡ä¸æ–­ä¿®æ”¹npathå’Œnstepçš„å€¼ï¼Œå¯ä»¥å‘ç°nstepçš„å€¼å¯¹æœ€ç»ˆç»“æœå³æ¨¡æ‹Ÿçš„$\mathbb{P}(\tau_m \leq t )$å€¼æ›´å…·å½±å“åŠ›ï¼Œä¹Ÿå°±æ˜¯è¯´nstepè¶Šå¤§ï¼Œåˆ™æ¯æ¡è·¯å¾„çš„æ³¢åŠ¨æ¬¡æ•°è¶Šå¤šï¼Œæ¯æ¬¡æ³¢åŠ¨å¹…åº¦ä¹Ÿè¶Šå°ï¼Œè¶Šç¬¦åˆå¸ƒæœ—è¿åŠ¨çš„ç‰¹æ€§ã€‚</p>
</blockquote>

<h4 id="2-æ£€éªŒç»ˆå€¼åˆ†å¸ƒçš„å‡å€¼æ ‡å‡†å·®åŠç›´æ–¹å›¾">2. æ£€éªŒç»ˆå€¼åˆ†å¸ƒçš„å‡å€¼ã€æ ‡å‡†å·®åŠç›´æ–¹å›¾</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mean</span> <span class="o">=</span> <span class="n">paths</span><span class="p">[:,</span><span class="n">nstep</span><span class="o">*</span><span class="n">t</span><span class="p">].</span><span class="n">mean</span><span class="p">()</span>
<span class="n">var</span> <span class="o">=</span> <span class="n">paths</span><span class="p">[:,</span><span class="n">nstep</span><span class="o">*</span><span class="n">t</span><span class="p">].</span><span class="n">var</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="s">"sample_mean = %f"</span> <span class="o">%</span> <span class="n">mean</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"sample_var = %f"</span> <span class="o">%</span> <span class="n">var</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sample_mean = 0.002820
sample_var = 2.979638
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">paths</span><span class="p">[:,</span><span class="n">nstep</span><span class="o">*</span><span class="n">t</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'r'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="http://localhost:4000/assets/images/SCFF03/output_103_0.png" alt="png" /></p>

<h4 id="3-æ±‚-tau_m-leq-t-çš„æ¦‚ç‡å³åœ¨æ—¶é—´-t-å†…è·¯å¾„è¾¾åˆ°æˆ–è¶…è¿‡mçš„æ¡æ•°">3. æ±‚ $\tau_{m} \leq t$ çš„æ¦‚ç‡ï¼Œå³åœ¨æ—¶é—´ $t$ å†…è·¯å¾„è¾¾åˆ°æˆ–è¶…è¿‡mçš„æ¡æ•°</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">actual_prob</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">paths</span><span class="p">.</span><span class="nb">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="n">npaths</span>
<span class="n">actual_prob</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.2485
</code></pre></div></div>

<h4 id="4-tau_m-leq-t-çš„ç†è®ºæ¦‚ç‡">4. $\tau_{m} \leq t$ çš„ç†è®ºæ¦‚ç‡</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="n">st</span>

<span class="n">theoretical_prob</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">st</span><span class="p">.</span><span class="n">norm</span><span class="p">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">theoretical_prob</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.24821307898992373
</code></pre></div></div>

<blockquote>
  <p>å®é™…å€¼ä¸ç†è®ºå€¼çš„å·®å¼‚ç™¾åˆ†ç‡</p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">actual_prob</span> <span class="o">-</span> <span class="n">theoretical_prob</span><span class="p">)</span> <span class="o">/</span> <span class="n">theoretical_prob</span> <span class="o">*</span> <span class="mi">100</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.11559463797953867
</code></pre></div></div>

<h4 id="5-å¾ªç¯æ–¹æ³•">5. å¾ªç¯æ–¹æ³•</h4>

<blockquote>
  <p>å¦‚ä»¥ä¸Šæ­¥éª¤1ä¸­ç”Ÿæˆçš„<code class="language-plaintext highlighter-rouge">[npath, nstep*t]</code>ç»´çŸ©é˜µè¶…å‡ºå†…å­˜ï¼Œå¯ç”¨ä»¥ä¸‹å¾ªç¯å½¢å¼è§£å†³</p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">npaths</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">nstep</span> <span class="o">=</span> <span class="mi">10000</span>

<span class="n">path_max</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npaths</span><span class="p">):</span>
    <span class="n">paths_</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">nstep</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">nstep</span><span class="o">*</span><span class="n">t</span><span class="p">))</span>
    <span class="n">paths_</span> <span class="o">=</span> <span class="n">paths_</span><span class="p">.</span><span class="n">cumsum</span><span class="p">()</span>
    <span class="n">path_max</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">paths_</span><span class="p">.</span><span class="nb">max</span><span class="p">())</span>
<span class="n">path_max</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">path_max</span><span class="p">)</span>
<span class="n">actual_prob</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">path_max</span> <span class="o">&gt;=</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="n">npaths</span>

<span class="k">print</span><span class="p">(</span><span class="n">actual_prob</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">theoretical_prob</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">actual_prob</span> <span class="o">-</span> <span class="n">theoretical_prob</span><span class="p">)</span> <span class="o">/</span> <span class="n">theoretical_prob</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.2489
0.24821307898992373
0.2767465005758886
</code></pre></div></div>

<h4 id="6-å¯¹ç§°æ€§">6. å¯¹ç§°æ€§</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">actual_prob</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">paths</span><span class="p">.</span><span class="nb">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="n">npaths</span>
<span class="n">actual_prob</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.2522
</code></pre></div></div>

<h3 id="373-å°è§„æ¨¡ç¤ºä¾‹">3.7.3 å°è§„æ¨¡ç¤ºä¾‹</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">npaths</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">nstep</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">t</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">steps</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">nstep</span><span class="p">),</span> <span class="n">t</span><span class="p">)</span>
<span class="n">paths</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">nstep</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">npaths</span><span class="p">,</span> <span class="n">nstep</span><span class="o">*</span><span class="n">t</span><span class="p">))</span>
<span class="n">paths</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">npaths</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">paths</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">paths</span> <span class="o">=</span> <span class="n">paths</span><span class="p">.</span><span class="n">cumsum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mean</span> <span class="o">=</span> <span class="n">paths</span><span class="p">[:,</span><span class="n">nstep</span><span class="o">*</span><span class="n">t</span><span class="p">].</span><span class="n">mean</span><span class="p">()</span>
<span class="n">var</span> <span class="o">=</span> <span class="n">paths</span><span class="p">[:,</span><span class="n">nstep</span><span class="o">*</span><span class="n">t</span><span class="p">].</span><span class="n">var</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="s">"sample_mean = %f"</span> <span class="o">%</span> <span class="n">mean</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"sample_var = %f"</span> <span class="o">%</span> <span class="n">var</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sample_mean = 0.077913
sample_var = 2.815512
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npaths</span><span class="p">):</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">paths</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">paths</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s">'b'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'r'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'r'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
</code></pre></div></div>

<p>â€‹  <br />
<img src="http://localhost:4000/assets/images/SCFF03/output_118_0.png" alt="png" />
â€‹</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">actual_prob</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">paths</span><span class="p">.</span><span class="nb">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="n">npaths</span>
<span class="n">actual_prob</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.3
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">theoretical_prob</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">st</span><span class="p">.</span><span class="n">norm</span><span class="p">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">theoretical_prob</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.37109336952269745
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">actual_prob</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">paths</span><span class="p">.</span><span class="nb">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="n">npaths</span>
<span class="n">actual_prob</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.3
</code></pre></div></div>

<h3 id="38-ç•ªå¤–">3.8 ç•ªå¤–</h3>

<h3 id="381-å¯¹æ•°æ­£æ€åˆ†å¸ƒ">3.8.1 å¯¹æ•°æ­£æ€åˆ†å¸ƒ</h3>

<p>åœ¨æ¦‚ç‡è®ºä¸ç»Ÿè®¡å­¦ä¸­ï¼Œä»»æ„éšæœºå˜é‡çš„<code class="language-plaintext highlighter-rouge">å¯¹æ•°</code>æœä»<code class="language-plaintext highlighter-rouge">æ­£æ€åˆ†å¸ƒ</code>ï¼Œåˆ™è¿™ä¸ªéšæœºå˜é‡æœä»çš„åˆ†å¸ƒç§°ä¸º<code class="language-plaintext highlighter-rouge">å¯¹æ•°æ­£æ€åˆ†å¸ƒ</code>ã€‚å³å¦‚æœ$Y$æ˜¯æ­£æ€åˆ†å¸ƒçš„éšæœºå˜é‡ï¼Œåˆ™$\exp(Y)$ä¸ºå¯¹æ•°æ­£æ€åˆ†å¸ƒï¼›åŒæ ·ï¼Œå¦‚æœ$X$æ˜¯å¯¹æ•°æ­£æ€åˆ†å¸ƒï¼Œåˆ™$\ln(X)$ä¸ºæ­£æ€åˆ†å¸ƒã€‚å¦‚æœä¸€ä¸ªå˜é‡å¯ä»¥çœ‹åšæ˜¯è®¸å¤šå¾ˆå°ç‹¬ç«‹å› å­çš„ä¹˜ç§¯ï¼Œåˆ™è¿™ä¸ªå˜é‡å¯ä»¥çœ‹åšæ˜¯<a href="https://zh.wikipedia.org/wiki/%E5%AF%B9%E6%95%B0%E6%AD%A3%E6%80%81%E5%88%86%E5%B8%83">å¯¹æ•°æ­£æ€åˆ†å¸ƒ</a>ã€‚ä¸€ä¸ªå…¸å‹çš„ä¾‹å­æ˜¯è‚¡ç¥¨æŠ•èµ„çš„é•¿æœŸæ”¶ç›Šç‡ï¼Œä»–å¯ä»¥çœ‹ä½œæ˜¯æ¯å¤©æ”¶ç›Šç‡çš„ä¹˜ç§¯ã€‚</p>

<p>å¯¹äº$Y \sim N(\mu, \sigma)$ï¼Œ$X = e ^ Y$ï¼Œå¯¹æ•°æ­£æ€åˆ†å¸ƒ$X$çš„æ¦‚ç‡å¯†åº¦å‡½æ•°ä¸º</p>

\[f(x; \mu, \sigma) = \frac{1}{\sqrt{2 \pi} x \sigma} e ^ {-\frac{(\ln x - \mu) ^ 2}{2 \sigma ^ 2}} \ \ \text{for} \ \sigma \geq 0 \ \text{and} \ -\infty \leq \mu \leq \infty .\]

<p>å…¶å€¼åŸŸä¸º$x \in [0, +\infty)$</p>

<p>å…¶æœŸæœ›å€¼åŠæ–¹å·®åˆ†åˆ«ä¸º</p>

\[\mathbb{E}(X) = e ^ {\mu + \sigma ^ 2 / 2}\]

\[\mathbb{Var}(X) = (e ^ {\sigma ^ 2} - 1) e ^ {2 \mu + \sigma ^ 2}\]

<h3 id="382-å‡ ä½•å¸ƒæœ—è¿åŠ¨">3.8.2 å‡ ä½•å¸ƒæœ—è¿åŠ¨</h3>

<p>ç”±ä¸Šé¢3.2.7èŠ‚æˆ‘ä»¬çŸ¥é“ä¼°ä»·è¿‡ç¨‹æœä»<a href="https://zh.wikipedia.org/wiki/%E5%87%A0%E4%BD%95%E5%B8%83%E6%9C%97%E8%BF%90%E5%8A%A8">å‡ ä½•å¸ƒæœ—è¿åŠ¨</a>ï¼Œå³</p>

\[S_t = S_0 \exp \left( \sigma W(t) + (r - \frac{\sigma^2}{2})t\right) \tag{1.31}\]

<p>å°†ä¸Šå¼åšå¯¹æ•°å˜æ¢åå³å¾—</p>

\[\ln \left( \frac{S_t}{S_0} \right) = \sigma W(t) + (r - \frac{\sigma^2}{2})t\]

<p>$Y = \ln \left( \frac{S_t}{S_0} \right)$æœä»æ­£æ€åˆ†å¸ƒï¼Œä¸”$Y \sim N \left( (r - \frac{\sigma^2}{2})t, \ \sigma \sqrt{t} \right)$ å³$\hat{\mu} = (r - \frac{\sigma^2}{2})t$ï¼Œ $\hat{\sigma} = \sigma \sqrt{t}$</p>

<p>å°†$\hat{\mu}$å’Œ$\hat{\sigma}$åˆ†åˆ«å¸¦å…¥å¯¹æ•°æ­£æ€åˆ†å¸ƒçš„æœŸæœ›å’Œæ–¹å·®å…¬å¼ï¼Œå³å¾—</p>

\[\mathbb{E}(e ^ Y) = e ^ {\hat{\mu} + \hat{\sigma} ^ 2 / 2}\]

\[\mathbb{Var}(e ^ Y) = (e ^ {\hat{\sigma} ^ 2} - 1) e ^ {2 \hat{\mu} + \hat{\sigma} ^ 2}\]

<p>è¿›ä¸€æ­¥æ•´ç†åå³å¯å¾—åˆ°ï¼š</p>

\[\mathbb{E} (S_t) = S_0 e ^ {r t}\]

\[\mathbb{Var}(S_t) = S_0 ^ 2 e ^ {2 r t} \left( e ^ {\sigma ^ 2 t} - 1\right)\]

<p>å…¨æ–‡å®Œ$\blacksquare$</p>

<p>è‡´è°¢ï¼š</p>

<p>å¦ˆå’ªå”LaTeXåŠ©åŠ› <a href="https://www.latexlive.com">åœ¨çº¿LaTeX</a></p>

<p>å‚è€ƒ:</p>

<p><a href="https://book.douban.com/subject/2187921/">Stochastic Calculus for Finance II - Continuous-Time Models</a></p>

<p><a href="https://zh.wikipedia.org/wiki/Wikipedia:%E9%A6%96%E9%A1%B5">ç»´åŸºç™¾ç§‘</a></p>
:ET