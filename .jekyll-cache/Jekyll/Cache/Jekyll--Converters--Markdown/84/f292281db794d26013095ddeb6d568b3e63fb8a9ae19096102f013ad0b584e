I"÷<p>2008å¹´çš„1æ¬¡è€ƒè¯ç»å†ï¼Œç¬¬1æ¬¡çŸ¥é“äº†æœŸæƒå¹¶å­¦åˆ°äº†æœŸæƒå®šä»·çš„Black-Scholes-Mertonå…¬å¼ï¼Œè¢«å…¶æ·±æ·±è¿·ä½ï¼Œæ–­æ–­ç»­ç»­ç¿»é˜…äº†è®¸å¤šä¹¦ç±åŠæ–‡çŒ®èµ„æ–™ï¼ŒåŒ…æ‹¬Hullé‚£æœ¬åŠåŸºç¡€çš„æ•°å­¦åˆ†æã€å®åˆ†æåŠåŸºäºæµ‹åº¦è®ºçš„æ¦‚ç‡è®ºç­‰ç­‰ï¼Œä½†ç”±äºå¤§å­¦ä¸“ä¸šå’Œæ•°å­¦ä¸ç›¸å…³ï¼Œçœ‹èµ·æ¥å¾ˆåƒåŠ›ï¼Œè™½æœ‰æ”¶è·ä½†æ„Ÿè§‰å´ä¸â€‹Black-Scholes-Mertonå…¬å¼æ¸è¡Œæ¸è¿œï¼Œéœ€è¦è¡¥ä¹ çš„åŸºç¡€çŸ¥è¯†å¤ªå¤šã€‚ç›´åˆ°å·¥ä½œåäº2015å¹´å·¦å³å¼€å§‹è¯»ä¸–å›¾å½±å°å‡ºç‰ˆçš„<em>Stochastic Calculus for Finance II</em>æ–¹æ‰æœ‰ç§é†é†çŒé¡¶çš„æ„Ÿè§‰ï¼Œä¼¼æ‡‚éæ‡‚ä¸­çœ‹åˆ°ç¬¬5ç« å¼€å¤´åå°±å› ç§ç§åŸå› æ”¾å¼ƒäº†ã€‚</p>

<p>æ—¶é—´ä¸€ç›´æ¥åˆ°äº†2021å¹´ï¼Œè¶<em>COVID-19</em>ç–«æƒ…æœŸé—´å·¥ä½œä¹‹ä½™ï¼Œä¸å¿˜åˆå¿ƒåˆé‡æ–°æ‹¾èµ·é‚£æ®µè®°å¿†ï¼Œä»å¤´å¼€å§‹åˆæ¥åˆ°äº†ç¬¬5ç« ï¼Œè¿‡å¾€çš„ç–‘æƒ‘åŠä¸è§£åœ¨æ­¤åˆ»æ­£é€æ­¥æ¶ˆæ•£ã€‚</p>

<p>åœ¨æ­¤ç»“åˆ<em>Stochastic Calculus for Finance II</em>å‰5ç« çš„å­¦ä¹ ï¼Œå¯¹é£é™©ä¸­æ€§æµ‹åº¦ä¸‹çš„Black-Scholes-Mertonç†è®ºæ¨å¯¼åšä¸ªæ€»ç»“ï¼Œå¹¶ç»“åˆC++å’ŒPythonå®ç°å…¶å®šä»·å…¬å¼ï¼Œä»¥ä¾¿å¯¹ç»™å®šçš„å‚æ•°ï¼Œè®¡ç®—å‡ºæœŸæƒä»·æ ¼ã€‚å¸Œæœ›è‹¥å¹²å¹´ä»¥åè¿˜èƒ½ä¸å¿˜åˆå¿ƒï¼Œç…§ç€ç¬”è®°é¡ºè—¤æ‘¸ç“œğŸ‰</p>

<h3 id="1-é£é™©ä¸­æ€§æµ‹åº¦ä¸‹çš„è‚¡ä»·è¿‡ç¨‹">1. é£é™©ä¸­æ€§æµ‹åº¦ä¸‹çš„è‚¡ä»·è¿‡ç¨‹</h3>

<h4 id="11-æ¦‚ç‡æµ‹åº¦mathbbpä¸‹çš„è‚¡ä»·è¿‡ç¨‹">1.1 æ¦‚ç‡æµ‹åº¦$\mathbb{P}$ä¸‹çš„è‚¡ä»·è¿‡ç¨‹</h4>

<p>å‡è®¾ $W(t), 0 \leq t \leq T $æ˜¯æ¦‚ç‡ç©ºé—´$(\Omega, \mathcal{F}, \mathbb{P})$ä¸Šçš„å¸ƒæœ—è¿åŠ¨ï¼Œ$\mathcal{F}(t), 0\leq t \leq T$æ˜¯è¯¥å¸ƒæœ—è¿åŠ¨çš„åŸŸæµï¼Œè€ƒè™‘è‚¡ä»·$S(t)$ï¼Œå…¶å¾®åˆ†å¦‚ä¸‹ï¼š</p>

\[d S(t)=\alpha(t) S(t) d t+\sigma(t) S(t) d W(t), \quad 0 \leq t \leq T.  \tag{1.1}\]

<p>å…¶ä¸­å¹³å‡å›æŠ¥ç‡$\alpha(t)$å’Œè‚¡ä»·æ³¢åŠ¨ç‡$\sigma(t)$ä¸ºé€‚åº”æ€§è¿‡ç¨‹ï¼Œåˆ™$S(t)$æ»¡è¶³ä»¥ä¸‹ç­‰å¼ï¼š</p>

\[S(t)=S(0) \exp \left\{\int_{0}^{t} \sigma(s) d W(s)+\int_{0}^{t}\left[\alpha(s)-\frac{1}{2} \sigma^{2}(s)\right] d s\right\} \tag{1.2}\]

<p>å‡è®¾æˆ‘ä»¬æœ‰é€‚åº”æ€§åˆ©ç‡è¿‡ç¨‹$R(t)$ï¼Œå®šä¹‰æŠ˜ç°è¿‡ç¨‹</p>

\[D(t)=e^{-\int_{0}^{t} R(s) d s} \tag{1.3}\]

<p>åˆ™</p>

\[d D(t)=-R(t) D(t) d t \tag{1.4}\]

<p>$D(t)S(t)$åŠå…¶å¾®åˆ†$d (D(t)S(t))$åˆ†åˆ«ä¸ºï¼š</p>

\[D(t) S(t)=S(0) \exp \left\{\int_{0}^{t} \sigma(s) d W(s)+\int_{0}^{t}\left[\alpha(s)-R(s)-\frac{1}{2} \sigma^{2}(s)\right] d s\right\} \tag{1.5}\]

\[\begin{aligned}
d(D(t) S(t)) &amp;=[\alpha(t)-R(t)] D(t) S(t) d t+\sigma(t) D(t) S(t) d W(t) \\
\\
&amp;=\sigma(t) D(t) S(t)[\Theta(t) d t+d W(t)]
\end{aligned} \tag{1.6}\]

<p>å…¶ä¸­å®šä¹‰é£é™©çš„å¸‚åœºä»·æ ¼$\Theta(t)=\frac{\alpha(t)-R(t)}{\sigma(t)} $ã€‚</p>

<h4 id="12-girsanov-theorem">1.2 <em>Girsanov Theorem</em></h4>

<p>å‡è®¾$W(t), 0 &lt; t &lt; T$æ˜¯æ¦‚ç‡ç©ºé—´$(\Omega, \mathcal{F}, \mathbb{P})$ä¸Šçš„å¸ƒæœ—è¿åŠ¨ï¼Œ$\mathcal{F}(t)$ä¸ºè¯¥å¸ƒæœ—è¿åŠ¨çš„åŸŸæµï¼Œ$\Theta(t), 0 &lt; t &lt; T$ä¸ºé€‚åº”æ€§è¿‡ç¨‹ã€‚æˆ‘ä»¬å®šä¹‰</p>

\[Z(t) =\exp \left\{-\int_{0}^{t} \Theta(u) d W(u)-\frac{1}{2} \int_{0}^{t} \Theta^{2}(u) d u\right\} \tag{1.7}\]

\[\widetilde{W}(t) =W(t)+\int_{0}^{t} \Theta(u) d u \tag{1.8}\]

<p>å¹¶å‡è®¾</p>

\[\mathbb{E} \int_{0}^{T} \Theta^{2}(u) Z^{2}(u) d u&lt;\infty \tag{1.9}\]

<p>è®©$Z = Z(T)$ã€‚é‚£ä¹ˆ$\mathbb{E}Z = 1$ä¸”åœ¨ç”±</p>

\[\widetilde{\mathbb{P}}(A) = \int_{A}Z(\omega) d \mathbb{P}(\omega) \quad \text{å¯¹æ‰€æœ‰} A \in \mathcal{F}. \tag{1.10}\]

<p>å®šä¹‰çš„æ¦‚ç‡æµ‹åº¦$\widetilde{\mathbb{P}}$ä¸‹ï¼Œ$\widetilde{W}(t), 0 &lt; t &lt; T$æ˜¯å¸ƒæœ—è¿åŠ¨ã€‚$\Box$</p>

<h4 id="13-æ¦‚ç‡æµ‹åº¦widetildemathbbpä¸‹çš„è‚¡ä»·è¿‡ç¨‹">1.3 æ¦‚ç‡æµ‹åº¦$\widetilde{\mathbb{P}}$ä¸‹çš„è‚¡ä»·è¿‡ç¨‹</h4>

<p>æ ¹æ®<em>Girsanov Theorem</em>ï¼Œåœ¨æ¦‚ç‡æµ‹åº¦$\widetilde{\mathbb{P}}$ä¸‹ï¼Œ$d \widetilde W(t) = \Theta(t) d t+d W(t) $ï¼Œå› æ­¤å…¬å¼$(1.6)$ä¹Ÿå¯ä»¥å†™ä¸º</p>

\[d (D(t)S(t)) = \sigma(t) D(t) S(t) d \widetilde W(t) \tag{1.11}\]

<p>ä¸¤è¾¹åŒæ—¶ç§¯åˆ†</p>

\[D(t) S(t)=S(0)+\int_{0}^{t} \sigma(u) D(u) S(u) d \widetilde{W}(u) \tag{1.12}\]

<p>ç”±äºåœ¨æ¦‚ç‡æµ‹åº¦$\widetilde{\mathbb{P}}$ä¸‹ï¼Œ$\int_{0}^{t} \sigma(u) D(u) S(u) d  \widetilde{W}(u)$æ˜¯ä¼Šè—¤è¿‡ç¨‹ï¼Œå› æ­¤æ˜¯ä¸€ä¸ªé…ã€‚</p>

<p><strong>å› æ­¤æˆ‘ä»¬ç§°<em>Girsanov Theorem</em>ä¸‹çš„æ¦‚ç‡æµ‹åº¦$\widetilde{\mathbb{P}}$ä¸ºé£é™©ä¸­æ€§æµ‹åº¦(risk-neutral measure)</strong>ã€‚</p>

<p>å°†$d \widetilde W(t) = \Theta(t) d t+d W(t) $å¸¦å…¥å…¬å¼$(1.1)$ï¼Œå¯ä»¥å¾—åˆ°åœ¨æ¦‚ç‡æµ‹åº¦$\widetilde{\mathbb{P}}$ä¸‹ï¼Œå…¬å¼$(1.1)$å’Œ$(1.2)$åˆ†åˆ«å¯ä»¥æ”¹å†™æˆå…¬å¼$(1.13)$å’Œå…¬å¼$(1.14)$çš„å½¢å¼</p>

\[d S(t)= R(t) S(t) d t+\sigma(t) S(t) d \widetilde {W}(t) \tag{1.13}\]

\[S(t) = S(0) \exp \left\{\int_{0}^{t} \sigma(s) d \widetilde{W}(s)+\int_{0}^{t}\left[R(s)-\frac{1}{2} \sigma^{2}(s)\right] d s\right\} \tag{1.14}\]

<h3 id="2-é£é™©ä¸­æ€§æµ‹åº¦ä¸‹æŠ•èµ„ç»„åˆçš„ä»·å€¼è¿‡ç¨‹">2. é£é™©ä¸­æ€§æµ‹åº¦ä¸‹æŠ•èµ„ç»„åˆçš„ä»·å€¼è¿‡ç¨‹</h3>

<p>å‡è®¾æŠ•èµ„è€…åˆå§‹èµ„æœ¬ä¸º$X(0)$ï¼Œåœ¨ä»»æ„æ—¶é—´$t, 0 &lt; t &lt; T $æŒæœ‰$\Delta(t)$ä»½è‚¡ç¥¨ï¼ŒåŒæ—¶ä»¥åˆ©ç‡$R(t)$æŠ•èµ„æˆ–å€Ÿè´·äºè´§å¸å¸‚åœºï¼Œä»¥ç»´æŒè‡ªèèµ„çŠ¶æ€ï¼Œåˆ™æŠ•èµ„ç»„åˆä»·å€¼çš„å¾®åˆ†ä¸º</p>

\[\begin{aligned}
d X(t) &amp;=\Delta(t) d S(t)+R(t) \left[ X(t)-\Delta(t) S(t) \right] d t \\
\\
&amp;=\Delta(t) [\alpha(t) S(t) d t+\sigma(t) S(t) d W(t)]+R(t)[X(t)-\Delta(t) S(t)] d t \\
\\
&amp;=R(t) X(t) d t+\Delta(t)[\alpha(t)-R(t)] S(t) d t+\Delta(t) \sigma(t) S(t) d W(t) \\
\\
&amp;=R(t) X(t) d t+\Delta(t) \sigma(t) S(t)[\Theta(t) d t+d W(t)]
\end{aligned} \tag{2.1}\]

<p>æ ¹æ®$\text{Ito}$ä¹˜æ³•æ³•åˆ™ï¼Œç”±å…¬å¼$(1.4)$å’Œ$(1.6)$å¯å¾—</p>

\[\begin{aligned}
d(D(t) X(t)) &amp;=\Delta(t) \sigma(t) D(t) S(t)[\Theta(t) d t+d W(t)] \\
\\
&amp;=\Delta(t) d(D(t) S(t)) \\
\\
&amp;=\Delta(t) \sigma(t) D(t) S(t) d \widetilde W(t)
\end{aligned} \tag{2.2}\]

<p>ç”±æ­¤æŠ•èµ„è€…æœ‰ä¸¤ç§é€‰æ‹©ï¼š</p>

<ol>
  <li>
    <p>ä»¥åˆ©ç‡$R(t)$æŠ•èµ„äºè´§å¸å¸‚åœºï¼›</p>
  </li>
  <li>
    <p>åœ¨é£é™©ä¸­æ€§æµ‹åº¦$\widetilde{\mathbb{P}}$ä¸‹æŠ•èµ„äºå¹³å‡å›æŠ¥ç‡ä¸º$R(t)$çš„è‚¡ç¥¨ã€‚</p>
  </li>
</ol>

<p>ä½†ç”±äºåœ¨é£é™©ä¸­æ€§æµ‹åº¦$\widetilde{\mathbb{P}}$ä¸‹ï¼ŒæŠ•èµ„ç»„åˆçš„æŠ˜ç°ä»·å€¼$D(t)X(t)$æ˜¯é…ï¼Œå› æ­¤ä¸ç®¡æŠ•èµ„è€…å¦‚ä½•é€‰æ‹©ï¼Œå…¶æŠ•èµ„ç»„åˆçš„å¹³å‡å›æŠ¥ç‡å‡ä¸ºä¸º$R(t)$ã€‚</p>

<h3 id="3-é£é™©ä¸­æ€§æµ‹åº¦ä¸‹çš„æœŸæƒå®šä»·">3. é£é™©ä¸­æ€§æµ‹åº¦ä¸‹çš„æœŸæƒå®šä»·</h3>

<p>æˆ‘ä»¬ä»¤$\mathcal{F}(T)$å¯æµ‹çš„éšæœºå˜é‡$V(T)$è¡¨ç¤ºåœ¨æ—¶åˆ»$T$è¡ç”Ÿè¯åˆ¸ç©ºå¤´çš„æ½œåœ¨æ”¯ä»˜(<em>payoff</em>) $(S(T)-K)^+$ï¼ŒæŠ•èµ„è€…ä¸ºäº†å¯¹å†²çœ‹æ¶¨æœŸæƒç©ºå¤´å³æœªæ¥æ‰€é¢ä¸´çš„æ½œåœ¨æ”¯å‡º$V(T)$ï¼Œé‚£ä¹ˆå…¶æŒæœ‰çš„æŠ•èµ„ç»„åˆ$X(t)$éœ€è¦ä½¿ä»¥ä¸‹ç­‰å¼å‡ ä¹å¿…ç„¶æˆç«‹(<em>almost surely</em>)</p>

\[X(T) = V(T) \tag{3.1}\]

<p>æˆ‘ä»¬å…ˆå‡è®¾å…¬å¼$(3.1)$æˆç«‹ï¼Œå¹¶ç”±æ­¤ç¡®å®šåˆå§‹èµ„æœ¬$X(0)$å’Œ$\Delta t$è¿‡ç¨‹ã€‚ç”±$D(t)X(t)$åœ¨æµ‹åº¦$\widetilde{\mathbb{P}}$æ˜¯é…çš„äº‹å®æˆ‘ä»¬æœ‰</p>

\[D(t) X(t)=\widetilde{\mathbb{E}}[D(T) X(T) \mid \mathcal{F}(t)]=\widetilde{\mathbb{E}}[D(T) V(T) \mid \mathcal{F}(t)] \tag{3.2}\]

<p>$X(t)$è¡¨ç¤ºåœ¨æ—¶åˆ»$t$ä¸ºå®Œå…¨å¯¹å†²è¡ç”Ÿè¯åˆ¸æ”¯ä»˜$V(T)$æ‰€æŒæœ‰çš„æŠ•èµ„ç»„åˆä»·å€¼ï¼Œæˆ‘ä»¬å°†å…¶ç§°ä¹‹ä¸ºè¡ç”Ÿè¯åˆ¸åœ¨æ—¶åˆ» $t$ çš„ä»·æ ¼å¹¶ç”¨$V(t)$è¡¨ç¤ºï¼Œé‚£ä¹ˆå…¬å¼$(3.2)$å¯ä»¥å†™æˆ</p>

\[D(t) V(t)=\widetilde{\mathbb{E}}[D(T) V(T) \mid \mathcal{F}(t)], 0 \leq t \leq T \tag{3.3}\]

<p>ç”±äº$D(t)$æ˜¯$\mathcal{F}(t)$å¯æµ‹çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†å…¶ç§»åˆ°å…¬å¼å³ä¾§ï¼Œå¾—åˆ°</p>

\[V(t)=\widetilde{\mathbb{E}}\left[e^{-\int_{t}^{T} R(u) d u} V(T) \mid \mathcal{F}(t)\right], 0 \leq t \leq T \tag{3.4}\]

<p>æˆ‘ä»¬å°†å…¬å¼$(3.3)$å’Œ$(3.4)$æˆä¸ºè¿ç»­æ—¶é—´ä¸‹é£é™©ä¸­æ€§å®šä»·å…¬å¼(<em>risk-neutral pricing formula</em>)ã€‚</p>

<h3 id="4-æ¨å¯¼textblack-scholes-mertonå…¬å¼">4. æ¨å¯¼$\text{Black-Scholes-Merton}$å…¬å¼</h3>

<p>ä¸ºç®€å•èµ·è§ï¼Œæˆ‘ä»¬å‡è®¾$\sigma(t)$å’Œ$R(t)$åˆ†åˆ«ä¸ºå¸¸æ•° $\sigma$ å’Œ $r$ï¼Œåˆ™å…¬å¼$(3.4)$ç®€åŒ–ä¸º</p>

\[\widetilde{\mathbb{E}}\left[e^{-r(T-t)}(S(T)-K)^{+} \mid \mathcal{F}(t)\right] \tag{4.1}\]

<p>å…¬å¼$(4.1)$ä»…ä¾èµ–äºæ—¶åˆ»$t$å’Œè‚¡ä»·$S(t)$ï¼Œç”±äºå‡ ä½•å¸ƒæœ—è¿åŠ¨æ˜¯é©¬å°”å¯å¤«è¿‡ç¨‹ï¼Œå› æ­¤å­˜åœ¨$c(t, S(t))$æ»¡è¶³</p>

\[c(t, S(t)) = \widetilde{\mathbb{E}}\left[e^{-r(T-t)}(S(T)-K)^{+} \mid \mathcal{F}(t)\right] \tag{4.2}\]

<p>å…¬å¼$(1.10)$ç®€åŒ–ä¸º</p>

\[S(t) = S(0) \exp \left\{\sigma \widetilde{W}(t)+\left(r-\frac{1}{2} \sigma^{2}\right) t\right\} \tag{4.3}\]

<p>åˆ™$S(T)$ç­‰äº</p>

\[\begin{aligned}
S(T) &amp;=S(t) \exp \left\{\sigma(\widetilde{W}(T)-\widetilde{W}(t))+\left(r-\frac{1}{2} \sigma^{2}\right) \tau\right\} \\
\\
&amp;=S(t) \exp \left\{-\sigma \sqrt{\tau} Y+\left(r-\frac{1}{2} \sigma^{2}\right) \tau\right\}
\end{aligned} \tag{4.4}\]

<p>å…¶ä¸­$\tau = T - t$ï¼Œ$Y$æ˜¯æ ‡å‡†æ­£æ€éšæœºå˜é‡</p>

\[Y = - \frac{\widetilde{W}(T) - \widetilde{W}(t)} {\sqrt{T-t}} \tag{4.5}\]

<p>å…¬å¼$(4.2)$å¯ä»¥å†™æˆå¦‚ä¸‹å½¢å¼</p>

\[\begin{aligned}
c(t, x) &amp;= \widetilde{\mathbb{E}}\left[e^{-r \tau}\left(x \exp \left\{-\sigma \sqrt{\tau} Y+\left(r-\frac{1}{2} \sigma^{2}\right) \tau\right\}-K\right)^{+}\right] \\
\\
&amp;= \frac{1}{\sqrt{2 \pi}} \int_{-\infty}^{\infty} e^{-r \tau}\left[ x \exp \left\{-\sigma \sqrt{\tau} y+\left(r-\frac{1}{2} \sigma^{2}\right) \tau\right\}-K\right]^{+} e^{-\frac{1}{2} y^{2}} d y
\end{aligned} \tag{4.6}\]

<p>å…¶ä¸­è¢«ç§¯å‡½æ•°</p>

\[\left[ x \exp \left\{-\sigma \sqrt{\tau} y+\left(r-\frac{1}{2} \sigma^{2}\right) \tau\right\}-K\right]^{+} \tag{4.7}\]

<p>ä¸ºæ­£ï¼Œå½“ä¸”ä»…å½“</p>

\[y &lt; d_{-}(\tau, x)=\frac{1}{\sigma \sqrt{\tau}}\left[\log \frac{x}{K}+\left(r-\frac{1}{2} \sigma^{2}\right) \tau\right] \tag{4.8}\]

<p>ç”±æ­¤</p>

\[\begin{aligned}
c(t, x) &amp;=\frac{1}{\sqrt{2 \pi}} \int_{-\infty}^{d_{-}(\tau, x)} e^{-r \tau}\left(x \exp \left\{-\sigma \sqrt{\tau} y+\left(r-\frac{1}{2} \sigma^{2}\right) \tau\right\}-K\right) e^{-\frac{1}{2} y^{2}} d y \\
\\
&amp;=\frac{1}{\sqrt{2 \pi}} \int_{-\infty}^{d_{-}(\tau, x)} x \exp \left\{-\frac{y^{2}}{2}-\sigma \sqrt{\tau} y-\frac{\sigma^{2} \tau}{2}\right\} d y \\
\\
&amp;- \frac{1}{\sqrt{2 \pi}} \int_{-\infty}^{d_{-}(\tau, x)} e^{-r \tau} K e^{-\frac{1}{2} y^{2}} d y \\
\\
&amp;=\frac{x}{\sqrt{2 \pi}} \int_{-\infty}^{d_{-}(\tau, x)} \exp \left\{-\frac{1}{2}(y+\sigma \sqrt{\tau})^{2}\right\} d y-e^{-r \tau} K N\left(d_{-}(\tau, x)\right) \\
\\
&amp;=\frac{x}{\sqrt{2 \pi}} \int_{-\infty}^{d_{-}(\tau, x)+\sigma \sqrt{\tau}} \exp \left\{-\frac{z^{2}}{2}\right\} d z-e^{-r \tau} K N\left(d_{-}(\tau, x)\right) \\
\\
&amp;=x N\left(d_{+}(\tau, x)\right)-e^{-r \tau} K N\left(d_{-}(\tau, x)\right)
\end{aligned} \tag{4.9}\]

<p>å…¶ä¸­</p>

\[d_+(\tau, x) = d_-(\tau, x) + \sigma \sqrt{\tau} = d_{-}(\tau, x)=\frac{1}{\sigma \sqrt{\tau}}\left[\log \frac{x}{K}+\left(r+\frac{1}{2} \sigma^{2}\right) \tau\right] \tag{4.10}\]

<p>ç”±æ­¤æˆ‘ä»¬å¾—åˆ°äº†æ¬§å¼çœ‹æ¶¨æœŸæƒå®šä»·å…¬å¼</p>

\[\text{BSM}(\tau, x, K, r, \sigma) = x N\left(d_{+}(\tau, x)\right)-e^{-r \tau} K N\left(d_{-}(\tau, x)\right) \tag{4.11}\]

<h3 id="5-æ¬§å¼æœŸæƒå®šä»·å…¬å¼">5. æ¬§å¼æœŸæƒå®šä»·å…¬å¼</h3>

<p>æ ¹æ®ä¸Šè¿°å¯¹$\text{Black-Scholes-Merton}$æœŸæƒå®šä»·å…¬å¼çš„æ¨å¯¼ï¼Œå¯¹äºå½“å‰è‚¡ä»·ä¸º$S_0$ï¼Œè¡Œæƒä»·æ ¼ä¸º$K$ï¼Œè¡ŒæƒæœŸä¸º$T$ï¼Œæ— é£é™©åˆ©ç‡ä¸ºå¸¸æ•°$r$ï¼Œè‚¡ä»·æ³¢åŠ¨ç‡ä¸ºå¸¸æ•°$\sigma$çš„çœ‹æ¶¨æœŸæƒï¼Œå…¶æœŸæƒè´¹$c(S_0, K, T, r, \sigma)$ä¸ºï¼š</p>

\[c(S_0, K, T, r, \sigma)=N\left(d_{1}\right) S_{0}-N\left(d_{2}\right) K \exp (-r T) \tag{5.1}\]

<p>å…¶ä¸­</p>

\[d_{1} = \frac{1}{\sigma \sqrt{T}}\left(\log \left(\frac{S_0}{K}\right)+\left(r+\frac{\sigma^{2}}{2}\right) \sqrt{T}\right) \tag{5.2}\]

\[d_{2} = \frac{1}{\sigma \sqrt{T}}\left(\log \left(\frac{S_0}{K}\right)+\left(r-\frac{\sigma^{2}}{2}\right) \sqrt{T}\right) \tag{5.3}\]

<p>$N(x)$ä¸ºæ ‡å‡†æ­£æ€åˆ†å¸ƒç´¯ç§¯åˆ†å¸ƒå‡½æ•°ï¼š</p>

\[N(x) = \frac{1}{\sqrt{2 \pi}} \int_{-\infty}^{x} \exp \left(-\frac{t^{2}}{2}\right) d t \tag{5.4}\]

<p>å¯¹åº”çœ‹è·ŒæœŸæƒè´¹$p(S_0, K, T, r, \sigma)$ä¸º:</p>

\[p(S_0, K, T, r, \sigma)=N\left(-d_{2}\right) K \exp (-r T)-N\left(-d_{1}\right) S_0 \tag{5.5}\]

<h3 id="6-æœŸæƒå®šä»·çš„cå®ç°">6. æœŸæƒå®šä»·çš„C++å®ç°</h3>

<h4 id="61-å®ç°nxå‡½æ•°---from-scratch-to-boost-library">6.1 å®ç°$N(x)$å‡½æ•° - <em>From Scratch to Boost Library</em></h4>

<p>å®šä»·å…¬å¼$(1)$-$(5)$ä¸­æ¶‰åŠ$N(x)$ã€$\exp(x)$å’Œ$\log(x)$ç­‰3ä¸ªå‡½æ•°ï¼Œå…¶ä¸­$\exp(x)$å’Œ$\log(x)$å·²åœ¨æ ‡å‡†åº“<code class="language-plaintext highlighter-rouge">&lt;cmath&gt;</code>ä¸­å®ç°ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚å› æ­¤åªå‰©$N(x)$éœ€è¦æˆ‘ä»¬åœ¨æ ‡å‡†åº“å¤–è‡ªå·±å®ç°æˆ–å¯»æ±‚å…¶ä»–åº“çš„æ”¯æŒã€‚æˆ‘ä»¬æŒ‰ç…§å¦‚ä¸‹ä¸‰ç§æ–¹å¼åˆ†åˆ«è¿›è¡Œå®ç°ï¼š</p>

<ul>
  <li>å¤šé¡¹å¼é€¼è¿‘æ³•</li>
  <li>æ•°å€¼ç§¯åˆ†æ³•</li>
  <li>è°ƒç”¨<code class="language-plaintext highlighter-rouge">Boost</code>åº“</li>
</ul>

<h5 id="611-å¤šé¡¹å¼é€¼è¿‘æ³•">6.1.1 å¤šé¡¹å¼é€¼è¿‘æ³•</h5>

<p>å¦‚$x &gt; 0$ï¼Œå®šä¹‰$k = 1/(1 + 0.2316419x)$ï¼Œåˆ™$N(x)$å¯ç”¨å¦‚ä¸‹å…³äº$k$å¤šé¡¹å¼è¿›è¡Œé€¼è¿‘
\(\small 1 âˆ’ \frac{1}{\sqrt{2 \pi}} \exp(-\frac{x^2} {2}) k(0.319381530 + k(âˆ’0.356563782 + k(1.781477937 + k(âˆ’1.821255978 + 1.330274429k)))) \tag{6.1}\)</p>

<p>å€ŸåŠ©$N(x) + N(-x) = 1$å¯ä»¥æ±‚å¾—$N(-x)$å³$x &lt; 0$æ—¶$N(x)$çš„å€¼ã€‚</p>

<p>C++å®ç°å¦‚ä¸‹ï¼š</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">const</span> <span class="kt">double</span> <span class="n">Pi</span> <span class="o">=</span> <span class="mf">3.141592653589793</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">root2Pi</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">Pi</span><span class="p">);</span>

<span class="kt">double</span> <span class="nf">normcdf_poly</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">normcdf_ploy</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">);</span>
    <span class="kt">double</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.2316419</span> <span class="o">*</span> <span class="n">x</span><span class="p">);</span>
    <span class="kt">double</span> <span class="n">poly</span> <span class="o">=</span> <span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.319381530</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.356563782</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.781477937</span> 
                  <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.821255978</span> <span class="o">+</span> <span class="mf">1.330274429</span> <span class="o">*</span> <span class="n">k</span><span class="p">))));</span>
    <span class="kt">double</span> <span class="n">approx</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">root2Pi</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">poly</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">approx</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h5 id="612-æ•°å€¼ç§¯åˆ†æ³•">6.1.2 æ•°å€¼ç§¯åˆ†æ³•</h5>

<p>å¯¹äºå®æ•°åŸŸä¸Š$\mathbb R \to \mathbb R$çš„é»æ›¼ç§¯åˆ†</p>

\[F(b) - F(a) = \int_{a}^{b} f(x) d x \tag{6.2}\]

<p>ä»¤$\Delta x = \frac{(b-a)}{N}$ï¼Œæ ¹æ®é»æ›¼ç§¯åˆ†å®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä»¥ä¸‹çŸ©å½¢çš„é¢ç§¯å’Œé€¼è¿‘$\int_{a}^{b} f(x) d x$ï¼š</p>

\[\lim_{N \to \infty} \sum_{i=0}^{N-1} f\left(a+(i+\frac{1}{2}) \Delta x\right) \Delta x \tag{6.3}\]

<p>åªè¦$N$å–å€¼è¶³å¤Ÿå¤§å³å¯å¾ˆå¥½çš„é€¼è¿‘ç§¯åˆ†å€¼ï¼Œå¯ä»¥é€šè¿‡å®šä¹‰$f(x) = x ^ 2 + 1$è¿›è¡Œç®€å•éªŒè¯ï¼ŒC++å®ç°å¦‚ä¸‹ï¼š</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;iostream&gt;
#include &lt;cmath&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="kt">double</span> <span class="nf">f_x</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">double</span> <span class="nf">integrate_fx</span><span class="p">(</span><span class="kt">double</span> <span class="n">a</span><span class="p">,</span> <span class="kt">double</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">N</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">double</span> <span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="n">N</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">integrate</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">double</span> <span class="n">x</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">delta</span><span class="p">;</span>
        <span class="n">integrate</span> <span class="o">+=</span> <span class="n">f_x</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">delta</span><span class="p">;</span>
        <span class="n">i</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">integrate</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">double</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">integrate_</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
    
    <span class="n">integrate_</span> <span class="o">=</span> <span class="n">integrate_fx</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">integrate_</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="c1">//è¿”å›10+2/3(çº¦ç­‰äº10.666667)</span>
    
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ä¸‹é¢æˆ‘ä»¬è€ƒè™‘å¦‚ä½•ç”¨æ•°å€¼ç§¯åˆ†æ³•é€¼è¿‘</p>

\[N(x)=\frac{1}{\sqrt{2 \pi}} \int_{-\infty}^{x} \exp \left(-\frac{t^{2}}{2}\right) d t\]

<p>ç”±äºç§¯åˆ†ä¸‹é™ä¸º$- \infty$ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘è¿›è¡Œå˜é‡æ›¿æ¢ï¼Œå®šä¹‰$t = x + 1 - \frac{1} {s}$ï¼Œåˆ™$N(x)$ç­‰ä»·äºå¦‚ä¸‹ç§¯åˆ†ï¼š</p>

\[\frac{1} {\sqrt {2 \pi}} \int_{0}^{1} \frac{1}{s^{2}} \exp \left(-\frac{\left(x+1-\frac{1}{s}\right)^{2}}{2}\right) \mathrm{d} s \tag{6.4}\]

<p>C++å®ç°å¦‚ä¸‹ï¼š</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">double</span> <span class="nf">normcdf_integrate</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">delta</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">N</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">integrate</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">double</span> <span class="n">s</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">delta</span><span class="p">;</span>
        <span class="kt">double</span> <span class="n">t</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">pow</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="kt">double</span> <span class="n">f</span> <span class="o">=</span> <span class="n">pow</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">PI</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">pow</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span><span class="p">);</span>
        <span class="n">integrate</span> <span class="o">+=</span> <span class="n">f</span> <span class="o">*</span> <span class="n">delta</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">integrate</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h5 id="613-è°ƒç”¨booståº“">6.1.3 è°ƒç”¨<code class="language-plaintext highlighter-rouge">boost</code>åº“</h5>

<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è°ƒç”¨<code class="language-plaintext highlighter-rouge">boost</code>åº“ä¸­çš„ç´¯ç§¯åˆ†å¸ƒå‡½æ•°ï¼ˆ<strong>C</strong>umulative <strong>D</strong>istribution <strong>F</strong>unctionï¼Œç®€ç§°$\mathrm{cdf}$)çš„å®ç°</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include "boost\math\distributions\normal.hpp"
#include &lt;random&gt;
</span>
<span class="kt">double</span> <span class="nf">normcdf_boost</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">double</span> <span class="n">cdf</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
	
	<span class="n">boost</span><span class="o">::</span><span class="n">math</span><span class="o">::</span><span class="n">normal_distribution</span><span class="o">&lt;&gt;</span> <span class="n">norm</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">//ç”Ÿæˆæ ‡å‡†æ­£æ€åˆ†å¸ƒ</span>
	<span class="n">cdf</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">math</span><span class="o">::</span><span class="n">cdf</span><span class="p">(</span><span class="n">norm</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span> <span class="c1">//è®¡ç®—N(x)å€¼</span>
	<span class="k">return</span> <span class="n">cdf</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="62-æœŸæƒè´¹è®¡ç®—çš„cå®ç°">6.2 æœŸæƒè´¹è®¡ç®—çš„C++å®ç°</h4>

<p>å®ç°$N(x)$åï¼Œè®¡ç®—å…¬å¼$(1)$ä¸­æ¬§å¼çœ‹æ¶¨æœŸæƒ$c(S_0, K, T, r, \sigma)$çš„éšœç¢å°±æ¸…é™¤äº†ã€‚ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«å®šä¹‰<code class="language-plaintext highlighter-rouge">blackScholesCallPrice</code>å’Œ<code class="language-plaintext highlighter-rouge">blackScholesPutPrice</code>å‡½æ•°å®Œæˆè®¡ç®—$c(S_0, K, T, r, \sigma)$å’Œ$p(S_0, K, T, r, \sigma)$ã€‚</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">double</span> <span class="nf">blackScholesCallPrice</span><span class="p">(</span><span class="kt">double</span> <span class="n">K</span><span class="p">,</span> <span class="kt">double</span> <span class="n">T</span><span class="p">,</span> <span class="kt">double</span> <span class="n">S_t</span><span class="p">,</span> <span class="kt">double</span> <span class="n">vol</span><span class="p">,</span> <span class="kt">double</span> <span class="n">r</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">double</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">pow</span><span class="p">((</span><span class="n">vol</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">)),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">S_t</span> <span class="o">/</span> <span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">pow</span><span class="p">(</span><span class="n">vol</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">));</span>
    <span class="kt">double</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">d1</span> <span class="o">-</span> <span class="n">vol</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">);</span>

    <span class="c1">//ä»¥ä¸‹normcdf(x)å‡½æ•°3é€‰1ï¼Œé»˜è®¤é€‰normcdf_poly(x)ï¼Œä½¿ç”¨normcdf_boost(x)æ—¶è¯·è‡ªè¡Œé…ç½®booståº“</span>
    <span class="kt">double</span> <span class="n">callPrice</span> <span class="o">=</span> <span class="n">normcdf_poly</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span> <span class="o">*</span> <span class="n">S_t</span> <span class="o">-</span> <span class="n">normcdf_poly</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span> <span class="o">*</span> <span class="n">K</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span> <span class="o">*</span> <span class="n">T</span><span class="p">);</span> 
    <span class="c1">//double callPrice = normcdf_integrate(d1) * S_t - normcdf_integrate(d2) * K * exp(-r * T);</span>
    <span class="c1">//double callPrice = normcdf_boost(d1) * S_t - normcdf_boost(d2) * K * exp(-r * T);</span>
    <span class="k">return</span> <span class="n">callPrice</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">double</span> <span class="nf">blackScholesPutPrice</span><span class="p">(</span><span class="kt">double</span> <span class="n">K</span><span class="p">,</span> <span class="kt">double</span> <span class="n">T</span><span class="p">,</span> <span class="kt">double</span> <span class="n">S_t</span><span class="p">,</span> <span class="kt">double</span> <span class="n">vol</span><span class="p">,</span> <span class="kt">double</span> <span class="n">r</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">double</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">pow</span><span class="p">((</span><span class="n">vol</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">)),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">S_t</span> <span class="o">/</span> <span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">vol</span> <span class="o">*</span> <span class="n">vol</span><span class="p">)</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">));</span>
    <span class="kt">double</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">d1</span> <span class="o">-</span> <span class="n">vol</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">);</span>

    <span class="c1">//ä»¥ä¸‹normcdf(x)å‡½æ•°3é€‰1ï¼Œé»˜è®¤é€‰normcdf_poly(x)ï¼Œä½¿ç”¨normcdf_boost(x)æ—¶è¯·è‡ªè¡Œé…ç½®booståº“</span>
    <span class="kt">double</span> <span class="n">putPrice</span> <span class="o">=</span> <span class="n">normcdf_poly</span><span class="p">(</span><span class="o">-</span><span class="n">d2</span><span class="p">)</span> <span class="o">*</span> <span class="n">K</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span> <span class="o">-</span> <span class="n">normcdf_poly</span><span class="p">(</span><span class="o">-</span><span class="n">d1</span><span class="p">)</span> <span class="o">*</span> <span class="n">S_t</span><span class="p">;</span>
    <span class="c1">//double putPrice = normcdf_integrate(-d2) * K * exp(-r * T) - normcdf_integrate(-d1) * S_t;</span>
    <span class="c1">//double putPrice = normcdf_boost(-d2) * K * exp(-r * T) - normcdf_boost(-d1) * S_t;</span>
    <span class="k">return</span> <span class="n">putPrice</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="63-å®Œæ•´å·¥ç¨‹æ–‡ä»¶åŠæµ‹è¯•">6.3 å®Œæ•´å·¥ç¨‹æ–‡ä»¶åŠæµ‹è¯•</h4>

<p>å¤´æ–‡ä»¶<em>stdafx.h</em></p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#pragma once
#include &lt;iostream&gt;
#include &lt;cmath&gt;
</span><span class="c1">//è¯·åœ¨Visual Studioä¸­è‡ªè¡Œé…ç½®å¥½booståº“åå–æ¶ˆæ³¨é‡Š</span>
<span class="c1">//#include "boost\math\distributions\normal.hpp"</span>
<span class="c1">//#include &lt;random&gt;</span>
</code></pre></div></div>

<p>å¤´æ–‡ä»¶<em>OptionPricing.h</em></p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#pragma once
</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">PI</span> <span class="o">=</span> <span class="mf">3.14159265358979</span><span class="p">;</span> <span class="c1">//å®šä¹‰Piå€¼</span>

<span class="c1">//S_t: spotPrice</span>
<span class="c1">//T: maturity</span>
<span class="c1">//K: strikePrice</span>
<span class="c1">//vol: volatility</span>
<span class="c1">//r: riskFreeInterestRate</span>

<span class="c1">//å£°æ˜çœ‹æ¶¨æœŸæƒå®šä»·å…¬å¼</span>
<span class="kt">double</span> <span class="nf">blackScholesCallPrice</span><span class="p">(</span><span class="kt">double</span> <span class="n">K</span><span class="p">,</span> <span class="kt">double</span> <span class="n">T</span><span class="p">,</span> <span class="kt">double</span> <span class="n">S_t</span><span class="p">,</span> <span class="kt">double</span> <span class="n">vol</span><span class="p">,</span> <span class="kt">double</span> <span class="n">r</span><span class="p">);</span>

<span class="c1">//å£°æ˜çœ‹è·ŒæœŸæƒå®šä»·å…¬å¼</span>
<span class="kt">double</span> <span class="nf">blackScholesPutPrice</span><span class="p">(</span><span class="kt">double</span> <span class="n">K</span><span class="p">,</span> <span class="kt">double</span> <span class="n">T</span><span class="p">,</span> <span class="kt">double</span> <span class="n">S_t</span><span class="p">,</span> <span class="kt">double</span> <span class="n">vol</span><span class="p">,</span> <span class="kt">double</span> <span class="n">r</span><span class="p">);</span>
</code></pre></div></div>

<p>æºæ–‡ä»¶<em>OptionPricing.cpp</em></p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="cp">#include "OptionPricing.h"
#include "stdafx.h"
</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">root2Pi</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">PI</span><span class="p">);</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">double</span> <span class="nf">normcdf_poly</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">normcdf_poly</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">);</span>
    <span class="kt">double</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.2316419</span> <span class="o">*</span> <span class="n">x</span><span class="p">);</span>
    <span class="kt">double</span> <span class="n">poly</span> <span class="o">=</span> <span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.319381530</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.356563782</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.781477937</span>
        <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.821255978</span> <span class="o">+</span> <span class="mf">1.330274429</span> <span class="o">*</span> <span class="n">k</span><span class="p">))));</span>
    <span class="kt">double</span> <span class="n">approx</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">root2Pi</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">poly</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">approx</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">double</span> <span class="nf">normcdf_integrate</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">delta</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">N</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">integrate</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">double</span> <span class="n">s</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">delta</span><span class="p">;</span>
        <span class="kt">double</span> <span class="n">t</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">pow</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="kt">double</span> <span class="n">f</span> <span class="o">=</span> <span class="n">pow</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">PI</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">pow</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span><span class="p">);</span>
        <span class="n">integrate</span> <span class="o">+=</span> <span class="n">f</span> <span class="o">*</span> <span class="n">delta</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">integrate</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//è¯·åœ¨Visual Studioä¸­è‡ªè¡Œé…ç½®å¥½booståº“åå–æ¶ˆæ³¨é‡Š</span>
<span class="cm">/*
static inline double normcdf_boost(double x)
{
    double cdf = 0.0;

    boost::math::normal_distribution&lt;&gt; norm(0, 1); //ç”Ÿæˆæ ‡å‡†æ­£æ€åˆ†å¸ƒ
    cdf = boost::math::cdf(norm, x); //è®¡ç®—N(x)å€¼
    return cdf;
}
*/</span>

<span class="c1">//S_t: spotPrice</span>
<span class="c1">//T: maturity</span>
<span class="c1">//K: strikePrice</span>
<span class="c1">//vol: volatility</span>
<span class="c1">//r: riskFreeInterestRate</span>

<span class="kt">double</span> <span class="nf">blackScholesCallPrice</span><span class="p">(</span><span class="kt">double</span> <span class="n">K</span><span class="p">,</span> <span class="kt">double</span> <span class="n">T</span><span class="p">,</span> <span class="kt">double</span> <span class="n">S_t</span><span class="p">,</span> <span class="kt">double</span> <span class="n">vol</span><span class="p">,</span> <span class="kt">double</span> <span class="n">r</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">double</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">pow</span><span class="p">((</span><span class="n">vol</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">)),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">S_t</span> <span class="o">/</span> <span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">pow</span><span class="p">(</span><span class="n">vol</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">));</span>
    <span class="kt">double</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">d1</span> <span class="o">-</span> <span class="n">vol</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">);</span>

    <span class="c1">//ä»¥ä¸‹normcdf(x)å‡½æ•°3é€‰1ï¼Œé»˜è®¤é€‰normcdf_poly(x)ï¼Œä½¿ç”¨normcdf_boost(x)æ—¶è¯·è‡ªè¡Œé…ç½®booståº“</span>
    <span class="kt">double</span> <span class="n">callPrice</span> <span class="o">=</span> <span class="n">normcdf_poly</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span> <span class="o">*</span> <span class="n">S_t</span> <span class="o">-</span> <span class="n">normcdf_poly</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span> <span class="o">*</span> <span class="n">K</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span> <span class="o">*</span> <span class="n">T</span><span class="p">);</span> 
    <span class="c1">//double callPrice = normcdf_integrate(d1) * S_t - normcdf_integrate(d2) * K * exp(-r * T);</span>
    <span class="c1">//double callPrice = normcdf_boost(d1) * S_t - normcdf_boost(d2) * K * exp(-r * T);</span>
    <span class="k">return</span> <span class="n">callPrice</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">double</span> <span class="nf">blackScholesPutPrice</span><span class="p">(</span><span class="kt">double</span> <span class="n">K</span><span class="p">,</span> <span class="kt">double</span> <span class="n">T</span><span class="p">,</span> <span class="kt">double</span> <span class="n">S_t</span><span class="p">,</span> <span class="kt">double</span> <span class="n">vol</span><span class="p">,</span> <span class="kt">double</span> <span class="n">r</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">double</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">pow</span><span class="p">((</span><span class="n">vol</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">)),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">S_t</span> <span class="o">/</span> <span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">vol</span> <span class="o">*</span> <span class="n">vol</span><span class="p">)</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">));</span>
    <span class="kt">double</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">d1</span> <span class="o">-</span> <span class="n">vol</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">);</span>

    <span class="c1">//ä»¥ä¸‹normcdf(x)å‡½æ•°3é€‰1ï¼Œé»˜è®¤é€‰normcdf_poly(x)ï¼Œä½¿ç”¨normcdf_boost(x)æ—¶è¯·è‡ªè¡Œé…ç½®booståº“</span>
    <span class="kt">double</span> <span class="n">putPrice</span> <span class="o">=</span> <span class="n">normcdf_poly</span><span class="p">(</span><span class="o">-</span><span class="n">d2</span><span class="p">)</span> <span class="o">*</span> <span class="n">K</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span> <span class="o">-</span> <span class="n">normcdf_poly</span><span class="p">(</span><span class="o">-</span><span class="n">d1</span><span class="p">)</span> <span class="o">*</span> <span class="n">S_t</span><span class="p">;</span>
    <span class="c1">//double putPrice = normcdf_integrate(-d2) * K * exp(-r * T) - normcdf_integrate(-d1) * S_t;</span>
    <span class="c1">//double putPrice = normcdf_boost(-d2) * K * exp(-r * T) - normcdf_boost(-d1) * S_t;</span>
    <span class="k">return</span> <span class="n">putPrice</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>æµ‹è¯•æ–‡ä»¶<em>main.cpp</em></p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;iostream&gt;
#include "OptionPricing.h"
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">double</span> <span class="n">K</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">S_t</span> <span class="o">=</span> <span class="mf">110.0</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">vol</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">r</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">T</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">call</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">put</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">putCallParity</span><span class="p">;</span>

    <span class="n">call</span> <span class="o">=</span> <span class="n">blackScholesCallPrice</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">S_t</span><span class="p">,</span> <span class="n">vol</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"The call option price is: "</span> <span class="o">&lt;&lt;</span> <span class="n">call</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="c1">//11.6725</span>
    <span class="n">put</span> <span class="o">=</span> <span class="n">blackScholesPutPrice</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">S_t</span><span class="p">,</span> <span class="n">vol</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"The put option price is: "</span> <span class="o">&lt;&lt;</span> <span class="n">put</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="c1">//0.183688</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"&lt;Put-Call-Parity = Call Price - Put Price&gt; Testing"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"&lt;Call Price - Put Price&gt; is: "</span> <span class="o">&lt;&lt;</span> <span class="n">call</span> <span class="o">-</span> <span class="n">put</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">putCallParity</span> <span class="o">=</span> <span class="n">S_t</span> <span class="o">-</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">K</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"&lt;Put-Call-Parity&gt; is: "</span> <span class="o">&lt;&lt;</span> <span class="n">putCallParity</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Wonderful! It's correct."</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>å…¶ä¸­çœ‹æ¶¨-çœ‹è·ŒæœŸæƒå¹³ä»·å…¬å¼ä¸º</p>

\[S_0 - \exp(-rT)K = c(S_0, K, T, r, \sigma) - p(S_0, K, T, r, \sigma) \tag{6.5}\]

<h3 id="7-æœŸæƒå®šä»·çš„pythonå®ç°">7. æœŸæƒå®šä»·çš„Pythonå®ç°</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>

<span class="o">//</span><span class="n">å®šä¹‰ä»¥ä¸‹ç®€å†™å˜é‡</span>
<span class="o">//</span><span class="n">K</span><span class="p">:</span> <span class="n">strikePrice</span>
<span class="o">//</span><span class="n">T</span><span class="p">:</span> <span class="n">maturity</span>
<span class="o">//</span><span class="n">S_t</span><span class="p">:</span> <span class="n">spotPrice</span>
<span class="o">//</span><span class="n">vol</span><span class="p">:</span> <span class="n">volatility</span>
<span class="o">//</span><span class="n">r</span><span class="p">:</span> <span class="n">riskFreeRate</span>

<span class="o">//</span><span class="n">å®šä¹‰d1å’Œd2</span>
<span class="k">def</span> <span class="nf">d1f</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">S_t</span><span class="p">,</span> <span class="n">vol</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">return</span> <span class="n">math</span><span class="p">.</span><span class="nb">pow</span><span class="p">(</span><span class="n">vol</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> \
    <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">S_t</span> <span class="o">/</span> <span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="nb">pow</span><span class="p">(</span><span class="n">vol</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">)))</span>

<span class="k">def</span> <span class="nf">d2f</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">S_t</span><span class="p">,</span> <span class="n">vol</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">return</span> <span class="n">d1f</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">S_t</span><span class="p">,</span> <span class="n">vol</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">vol</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>

<span class="o">//</span><span class="n">å®šä¹‰çœ‹æ¶¨</span><span class="o">-</span><span class="n">çœ‹è·ŒæœŸæƒè®¡ç®—å…¬å¼</span>
<span class="k">def</span> <span class="nf">blackScholesCallPrice</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">S_t</span><span class="p">,</span> <span class="n">vol</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="n">d1f</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">S_t</span><span class="p">,</span> <span class="n">vol</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="n">d2f</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">S_t</span><span class="p">,</span> <span class="n">vol</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>

    <span class="n">callPrice</span> <span class="o">=</span> <span class="n">norm</span><span class="p">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span> <span class="o">*</span> <span class="n">S_t</span> <span class="o">-</span> <span class="n">norm</span><span class="p">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span> <span class="o">*</span> <span class="n">K</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">callPrice</span>

<span class="k">def</span> <span class="nf">blackScholesPutPrice</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">S_t</span><span class="p">,</span> <span class="n">vol</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="n">d1f</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">S_t</span><span class="p">,</span> <span class="n">vol</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="n">d2f</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">S_t</span><span class="p">,</span> <span class="n">vol</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>

    <span class="n">putPrice</span> <span class="o">=</span> <span class="n">norm</span><span class="p">.</span><span class="n">cdf</span><span class="p">(</span><span class="o">-</span><span class="n">d2</span><span class="p">)</span> <span class="o">*</span> <span class="n">K</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span> <span class="o">-</span> <span class="n">norm</span><span class="p">.</span><span class="n">cdf</span><span class="p">(</span><span class="o">-</span><span class="n">d1</span><span class="p">)</span> <span class="o">*</span> <span class="n">S_t</span>
    <span class="k">return</span> <span class="n">putPrice</span>

<span class="o">//</span><span class="n">å®šä¹‰çœ‹æ¶¨</span><span class="o">-</span><span class="n">çœ‹è·ŒæœŸæƒå¹³ä»·æµ‹è¯•å…¬å¼</span>
<span class="k">def</span> <span class="nf">callPutParity</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">S_t</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">return</span> <span class="n">S_t</span> <span class="o">-</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">K</span>

<span class="o">//</span><span class="n">å¯¹ç»™å®šå˜é‡è¿›è¡Œæµ‹è¯•</span>
<span class="n">K</span> <span class="o">=</span> <span class="mf">100.0</span>
<span class="n">S_t</span> <span class="o">=</span> <span class="mf">110.0</span>
<span class="n">vol</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">r</span> <span class="o">=</span> <span class="mf">0.03</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="n">call</span> <span class="o">=</span> <span class="n">blackScholesCallPrice</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">S_t</span><span class="p">,</span> <span class="n">vol</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
<span class="n">put</span> <span class="o">=</span> <span class="n">blackScholesPutPrice</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">S_t</span><span class="p">,</span> <span class="n">vol</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
<span class="n">callPutParity_</span> <span class="o">=</span> <span class="n">callPutParity</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">S_t</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"The call option price is: {0}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">call</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">"The put option price is: {0}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">put</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Call price - put price is: {0}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">call</span> <span class="o">-</span> <span class="n">put</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">"The Call-Put-Parity is: {0}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">callPutParity_</span><span class="p">))</span>
</code></pre></div></div>

<p>è‡´è°¢ï¼š</p>

<p>å¦ˆå’ªå”LaTeXåŠ©åŠ› <a href="https://www.latexlive.com">åœ¨çº¿LaTeX</a></p>

<p>å‚è€ƒ:</p>

<p><a href="https://book.douban.com/subject/2187921/">Stochastic Calculus for Finance II - Continuous-Time Models</a></p>

<p><a href="https://nms.kcl.ac.uk/john.armstrong/cppbook/cpp-website.html">C++ for Financial Mathematics</a></p>

:ET